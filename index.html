<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم جامع مدیریت و گزارش‌گیری تجهیزات مخابراتی - شرکت توزیع نیروی برق استان یزد</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* استایل‌های پایه */
        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #2d8bc0;
            --accent-color: #57cc99;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --word-color: #2b579a;
            --excel-color: #217346;
            --whatsapp-color: #25D366;
            --telegram-color: #0088cc;
            --bale-color: #2a9df4;
            --hytra-green: #38a169;
            --hytra-blue: #3182ce;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 10px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* هدر اصلی */
        .main-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            font-size: 50px;
            color: var(--accent-color);
        }
        
        .header-text h1 {
            font-size: 2.4rem;
            margin-bottom: 10px;
        }
        
        .header-text h2 {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 500;
        }
        
        /* تب‌های اصلی */
        .main-tabs {
            display: flex;
            background-color: #edf2f7;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .main-tab {
            flex: 1;
            padding: 20px 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            color: #4a5568;
            text-align: center;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .main-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background-color: #ebf8ff;
        }
        
        .main-tab:hover:not(.active) {
            background-color: #e2e8f0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* کارت‌ها */
        .card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-right: 5px solid var(--secondary-color);
        }
        
        .card-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #eaeaea;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
        }
        
        /* فرم‌ها */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-col {
            flex: 1;
            min-width: 280px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .required::after {
            content: " *";
            color: var(--danger-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(45, 139, 192, 0.2);
        }
        
        /* جدول‌ها */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1300px;
        }
        
        thead {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        th {
            padding: 18px 15px;
            text-align: right;
            font-weight: 600;
            position: sticky;
            top: 0;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        tbody tr {
            border-bottom: 1px solid #f1f1f1;
            transition: background-color 0.2s;
        }
        
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tbody tr:hover {
            background-color: #e8f4fc;
        }
        
        td {
            padding: 15px;
            text-align: right;
        }
        
        /* دکمه‌ها */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2c5282;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: #212529;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info-color);
            color: white;
        }
        
        .btn-word {
            background-color: var(--word-color);
            color: white;
        }
        
        .btn-excel {
            background-color: var(--excel-color);
            color: white;
        }
        
        .btn-whatsapp {
            background-color: var(--whatsapp-color);
            color: white;
        }
        
        .btn-telegram {
            background-color: var(--telegram-color);
            color: white;
        }
        
        .btn-bale {
            background-color: var(--bale-color);
            color: white;
        }
        
        .btn-hytra-green {
            background-color: var(--hytra-green);
            color: white;
        }
        
        .btn-hytra-blue {
            background-color: var(--hytra-blue);
            color: white;
        }
        
        /* آمار */
        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 25px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        .stat-box {
            flex: 1;
            min-width: 180px;
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background-color: #f8f9fa;
            border-left: 5px solid;
            transition: transform 0.3s;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #718096;
        }
        
        /* مودال‌ها */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        /* تجهیزات */
        .equipment-type-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .equipment-option {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            background: white;
        }
        
        .equipment-option:hover {
            border-color: var(--secondary-color);
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .equipment-option.selected {
            border-color: var(--accent-color);
            background-color: #f0f9ff;
        }
        
        .equipment-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        /* وضعیت ارتباطی */
        .communication-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .communication-table th,
        .communication-table td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: center;
        }
        
        .communication-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }
        
        /* فهرست بها */
        .invoice-item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        
        /* رسپانسیو */
        @media (max-width: 992px) {
            .main-tabs {
                flex-direction: column;
            }
            
            .main-tab {
                padding: 15px;
                font-size: 14px;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-col {
                min-width: 100%;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
            
            .equipment-type-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .main-header {
                padding: 20px 15px;
            }
            
            .header-text h1 {
                font-size: 1.8rem;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .stat-box {
                min-width: 100%;
            }
            
            .equipment-type-options {
                grid-template-columns: 1fr;
            }
            
            .invoice-item-row {
                grid-template-columns: 1fr;
                gap: 5px;
            }
        }
        
        /* استایل‌های جدید برای یکپارچگی */
        .action-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .action-edit {
            background-color: #bee3f8;
            color: #2a4365;
        }
        
        .action-delete {
            background-color: #fed7d7;
            color: #742a2a;
        }
        
        .type-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 5px;
        }
        
        .type-fixed {
            background-color: #c6f6d5;
            color: #22543d;
        }
        
        .type-mobile {
            background-color: #bee3f8;
            color: #2a4365;
        }
        
        .type-handheld {
            background-color: #feebc8;
            color: #744210;
        }
        
        .search-box {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .search-field {
            flex: 1;
            min-width: 200px;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 40px;
            color: #718096;
            font-size: 1.2rem;
        }
        
        .no-results i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #cbd5e0;
        }
        
        /* پیام وضعیت */
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            display: none;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        /* کانتینر تجهیزات اضافه شده */
        .added-equipment-container {
            border: 2px dashed var(--accent-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
        }
        
        .added-equipment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        /* بخش‌های اختصاصی */
        .equipment-specific-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
            font-size: 16px;
            font-weight: 600;
        }
        
        /* متعلقات */
        .accessories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .accessory-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }
        
        /* تنظیمات گزارش */
        .report-settings {
            background-color: #f1f8ff;
            border: 1px solid #c3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        
        /* دکمه‌های اقدام */
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* گزارش ورد */
        .word-report-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            overflow: auto;
            padding: 20px;
        }
        
        .word-report-content {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            font-family: 'B Nazanin', 'Times New Roman', serif;
            line-height: 1.8;
        }
        
        .word-header {
            text-align: center;
            border-bottom: 3px double #000;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        /* مودال گزارش‌گیری */
        .report-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            overflow: auto;
        }
        
        .report-modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
        }
        
        .report-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .report-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .report-option:hover {
            border-color: var(--primary-color);
            background: #f8f9fa;
        }
        
        /* دسته‌بندی‌های دکمه */
        .btn-category {
            margin-top: 10px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .btn-category-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- هدر اصلی -->
        <div class="main-header">
            <div class="logo">
                <i class="fas fa-satellite-dish logo-icon"></i>
                <div class="header-text">
                    <h1><i class="fas fa-tools"></i> سیستم جامع مدیریت و گزارش‌گیری تجهیزات مخابراتی</h1>
                    <h2>شرکت توزیع نیروی برق استان یزد - مدیریت یکپارچه تجهیزات و بازدیدهای مخابراتی</h2>
                </div>
                <i class="fas fa-bolt logo-icon"></i>
            </div>
            <p>مدیریت تجهیزات هایترا | ثبت بازدید و سرویس | گزارش‌گیری جامع | خروجی اکسل و Word</p>
        </div>
        
        <!-- تب‌های اصلی -->
        <div class="main-tabs">
            <div class="main-tab active" data-tab="equipment-management">
                <i class="fas fa-tools"></i> مدیریت تجهیزات هایترا
            </div>
            <div class="main-tab" data-tab="equipment-visit">
                <i class="fas fa-clipboard-check"></i> بازدید و سرویس تجهیزات
            </div>
            <div class="main-tab" data-tab="import-export">
                <i class="fas fa-file-import"></i> واردسازی و خروجی
            </div>
            <div class="main-tab" data-tab="reports">
                <i class="fas fa-chart-bar"></i> گزارش‌گیری جامع
            </div>
        </div>
        
        <!-- ==================== تب مدیریت تجهیزات هایترا ==================== -->
        <div id="equipment-management-tab" class="tab-content active">
            <!-- اطلاعات کلی -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-database"></i> بانک اطلاعاتی تجهیزات هایترا</h3>
                
                <div class="stats">
                    <div class="stat-box" style="border-left-color: var(--hytra-green);">
                        <div class="stat-value" id="fixedCount">18</div>
                        <div class="stat-label">تجهیزات ثابت</div>
                    </div>
                    <div class="stat-box" style="border-left-color: var(--hytra-blue);">
                        <div class="stat-value" id="mobileCount">45</div>
                        <div class="stat-label">تجهیزات سیار</div>
                    </div>
                    <div class="stat-box" style="border-left-color: var(--warning-color);">
                        <div class="stat-value" id="handheldCount">35</div>
                        <div class="stat-label">تجهیزات دستی</div>
                    </div>
                    <div class="stat-box" style="border-left-color: var(--primary-color);">
                        <div class="stat-value" id="totalCount">98</div>
                        <div class="stat-label">کل تجهیزات</div>
                    </div>
                    <div class="stat-box" style="border-left-color: var(--accent-color);">
                        <div class="stat-value" id="cityCount">15</div>
                        <div class="stat-label">شهرستان‌ها</div>
                    </div>
                </div>
                
                <div class="button-group">
                    <div class="btn-category">
                        <div class="btn-category-title"><i class="fas fa-plus-circle"></i> عملیات اصلی</div>
                        <div class="btn-group">
                            <button class="btn btn-hytra-green" id="addEquipmentBtn">
                                <i class="fas fa-plus"></i> افزودن تجهیز جدید
                            </button>
                            <button class="btn btn-info" id="bulkImportBtn">
                                <i class="fas fa-file-import"></i> واردسازی گروهی
                            </button>
                            <button class="btn btn-warning" onclick="showQuickSearch()">
                                <i class="fas fa-search"></i> جستجوی سریع
                            </button>
                        </div>
                    </div>
                    
                    <div class="btn-category">
                        <div class="btn-category-title"><i class="fas fa-download"></i> خروجی‌ها</div>
                        <div class="btn-group">
                            <button class="btn btn-excel" id="exportAllExcelBtn">
                                <i class="fas fa-file-excel"></i> خروجی کامل اکسل
                            </button>
                            <button class="btn btn-word" id="exportReportBtn">
                                <i class="fas fa-file-word"></i> گزارش آماری
                            </button>
                            <button class="btn btn-danger" id="backupDataBtn">
                                <i class="fas fa-database"></i> پشتیبان گیری
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- فرم افزودن/ویرایش تجهیز -->
            <div class="card" id="equipmentFormContainer" style="display: none;">
                <h3 class="card-title"><i class="fas fa-plus-circle"></i> افزودن/ویرایش تجهیز هایترا</h3>
                
                <form id="equipmentForm">
                    <input type="hidden" id="editId" value="">
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="equipmentType"><i class="fas fa-tag"></i> نوع تجهیز *</label>
                            <select id="equipmentType" required>
                                <option value="">انتخاب کنید</option>
                                <option value="ثابت">ثابت</option>
                                <option value="سیار (خودرویی)">سیار (خودرویی)</option>
                                <option value="دستی">دستی</option>
                            </select>
                        </div>
                        
                        <div class="form-col">
                            <label for="city"><i class="fas fa-city"></i> شهرستان *</label>
                            <select id="city" required>
                                <option value="">انتخاب کنید</option>
                                <option value="ستاد( مرکز کنترل)">ستاد( مرکز کنترل)</option>
                                <option value="امور1">امور1</option>
                                <option value="امور2">امور2</option>
                                <option value="امور3">امور3</option>
                                <option value="زارچ">زارچ</option>
                                <option value="اشکذر">اشکذر</option>
                                <option value="میبد">میبد</option>
                                <option value="اردکان">اردکان</option>
                                <option value="تفت">تفت</option>
                                <option value="مهریز">مهریز</option>
                                <option value="بافق">بافق</option>
                                <option value="هرات">هرات</option>
                                <option value="مروست">مروست</option>
                                <option value="بهاباد">بهاباد</option>
                                <option value="ابرکوه">ابرکوه</option>
                                <option value="نیر">نیر</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="propertyNumber"><i class="fas fa-hashtag"></i> شماره اموالی</label>
                            <input type="text" id="propertyNumber" placeholder="مثلاً: 36317">
                        </div>
                        
                        <div class="form-col">
                            <label for="serialNumber"><i class="fas fa-barcode"></i> شماره سریال *</label>
                            <input type="text" id="serialNumber" required placeholder="مثلاً: 16N27A1081">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="brand"><i class="fas fa-trademark"></i> برند *</label>
                            <input type="text" id="brand" required value="هایترا" readonly>
                        </div>
                        
                        <div class="form-col">
                            <label for="hytraModel"><i class="fas fa-microchip"></i> مدل هایترا</label>
                            <select id="hytraModel">
                                <option value="">انتخاب کنید</option>
                                <option value="سری H">سری H</option>
                                <option value="سری جدید">سری جدید</option>
                                <option value="مدل ویژه">مدل ویژه</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="equipmentId"><i class="fas fa-id-card"></i> شناسه (ID)</label>
                            <input type="text" id="equipmentId" placeholder="مثلاً: 10000">
                        </div>
                        
                        <div class="form-col">
                            <label for="vehicleType"><i class="fas fa-car"></i> نوع خودرو</label>
                            <input type="text" id="vehicleType" placeholder="مثلاً: هیوندا">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="installationLocation"><i class="fas fa-map-marker-alt"></i> محل نصب</label>
                            <input type="text" id="installationLocation" placeholder="مثلاً: مرکز کنترل">
                        </div>
                        
                        <div class="form-col">
                            <label for="plate"><i class="fas fa-car-alt"></i> پلاک</label>
                            <input type="text" id="plate" placeholder="مثلاً: 943ع56">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="recipient"><i class="fas fa-user"></i> تحویل گیرنده</label>
                            <input type="text" id="recipient" placeholder="مثلاً: مهندس حسینی">
                        </div>
                        
                        <div class="form-col">
                            <label for="status"><i class="fas fa-check-circle"></i> وضعیت</label>
                            <select id="status">
                                <option value="فعال">فعال</option>
                                <option value="غیرفعال">غیرفعال</option>
                                <option value="در حال تعمیر">در حال تعمیر</option>
                                <option value="نیاز به سرویس">نیاز به سرویس</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes"><i class="fas fa-sticky-note"></i> توضیحات</label>
                        <textarea id="notes" rows="3" placeholder="توضیحات اضافی..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="lastServiceDate"><i class="fas fa-calendar-check"></i> تاریخ آخرین سرویس</label>
                            <input type="date" id="lastServiceDate">
                        </div>
                        
                        <div class="form-col">
                            <label for="nextServiceDate"><i class="fas fa-calendar-alt"></i> تاریخ سرویس بعدی</label>
                            <input type="date" id="nextServiceDate">
                        </div>
                    </div>
                    
                    <div class="button-group" style="justify-content: center; margin-top: 20px;">
                        <button type="submit" class="btn btn-hytra-green" id="saveEquipmentBtn">
                            <i class="fas fa-save"></i> ذخیره تجهیز
                        </button>
                        <button type="button" class="btn btn-warning" id="resetFormBtn">
                            <i class="fas fa-redo"></i> پاک کردن فرم
                        </button>
                        <button type="button" class="btn btn-danger" id="cancelFormBtn">
                            <i class="fas fa-times"></i> لغو
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- جستجو و فیلتر -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-search"></i> جستجو و فیلتر تجهیزات</h3>
                
                <div class="search-box">
                    <div class="search-field">
                        <label for="searchText"><i class="fas fa-search"></i> جستجوی متنی</label>
                        <input type="text" id="searchText" placeholder="شماره اموالی، سریال، پلاک، تحویل گیرنده...">
                    </div>
                    
                    <div class="search-field">
                        <label for="searchType"><i class="fas fa-filter"></i> نوع تجهیز</label>
                        <select id="searchType">
                            <option value="">همه نوع‌ها</option>
                            <option value="ثابت">تجهیزات ثابت</option>
                            <option value="سیار (خودرویی)">تجهیزات سیار</option>
                            <option value="دستی">تجهیزات دستی</option>
                        </select>
                    </div>
                    
                    <div class="search-field">
                        <label for="searchCity"><i class="fas fa-city"></i> شهرستان</label>
                        <select id="searchCity">
                            <option value="">همه شهرستان‌ها</option>
                            <option value="ستاد( مرکز کنترل)">ستاد( مرکز کنترل)</option>
                            <option value="امور1">امور1</option>
                            <option value="امور2">امور2</option>
                            <option value="امور3">امور3</option>
                        </select>
                    </div>
                </div>
                
                <div class="button-group" style="justify-content: center;">
                    <button class="btn btn-primary" id="searchBtn">
                        <i class="fas fa-search"></i> اجرای جستجو
                    </button>
                    <button class="btn btn-secondary" id="clearSearchBtn">
                        <i class="fas fa-redo"></i> پاک کردن فیلترها
                    </button>
                    <button class="btn btn-info" id="showAllBtn">
                        <i class="fas fa-list"></i> نمایش همه
                    </button>
                </div>
                
                <div id="searchResultsCount" style="margin-top: 15px; text-align: center; font-weight: 600; color: var(--primary-color);">
                    نمایش 98 مورد از 98 تجهیز
                </div>
            </div>
            
            <!-- جدول تجهیزات -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-list"></i> لیست تجهیزات هایترا (<span id="totalItems">98</span> مورد)</h3>
                
                <div class="table-container">
                    <table id="equipmentTable">
                        <thead>
                            <tr>
                                <th>ردیف</th>
                                <th>نوع تجهیز</th>
                                <th>شهرستان</th>
                                <th>شماره اموالی</th>
                                <th>شماره سریال</th>
                                <th>برند</th>
                                <th>مدل هایترا</th>
                                <th>شناسه</th>
                                <th>نوع خودرو</th>
                                <th>محل نصب</th>
                                <th>پلاک</th>
                                <th>تحویل گیرنده</th>
                                <th>وضعیت</th>
                                <th>تاریخ سرویس</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="equipmentTableBody">
                            <!-- داده‌ها به صورت پویا بارگذاری می‌شوند -->
                        </tbody>
                    </table>
                    
                    <div class="no-results" id="noEquipment" style="display: none;">
                        <i class="fas fa-inbox"></i>
                        <p>هیچ تجهیزی یافت نشد.</p>
                        <p style="margin-top: 10px; font-size: 1rem;">برای افزودن تجهیز جدید از دکمه "افزودن تجهیز جدید" استفاده کنید.</p>
                    </div>
                </div>
                
                <div class="button-group" style="justify-content: center; margin-top: 20px;">
                    <button class="btn btn-excel" onclick="exportTableToExcel()">
                        <i class="fas fa-file-excel"></i> خروجی جدول به اکسل
                    </button>
                    <button class="btn btn-warning" onclick="printTable()">
                        <i class="fas fa-print"></i> چاپ جدول
                    </button>
                    <button class="btn btn-info" onclick="showStatistics()">
                        <i class="fas fa-chart-pie"></i> نمایش آمار
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ==================== تب بازدید و سرویس تجهیزات ==================== -->
        <div id="equipment-visit-tab" class="tab-content">
            <!-- اطلاعات کلی بازدید -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-alt"></i> اطلاعات کلی بازدید</h3>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="station-name" class="required">نام ایستگاه/واحد:</label>
                        <input type="text" id="station-name" name="station-name" required>
                    </div>
                    <div class="form-col">
                        <label for="visit-date" class="required">تاریخ بازدید:</label>
                        <input type="date" id="visit-date" name="visit-date" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="contractor-name" class="required">نام مجری/پیمانکار:</label>
                        <input type="text" id="contractor-name" name="contractor-name" placeholder="نام و نام خانوادگی مجری" required>
                    </div>
                    <div class="form-col">
                        <label for="location" class="required">امور/شهرستان:</label>
                        <select id="location" name="location" required>
                            <option value="">انتخاب کنید</option>
                            <option value="ستاد">ستاد</option>
                            <option value="ستاد (مرکز کنترل)">ستاد (مرکز کنترل)</option>
                            <option value="امور یک">امور یک</option>
                            <option value="امور دو">امور دو</option>
                            <option value="امور سه">امور سه</option>
                            <option value="امور چهار">امور چهار</option>
                            <option value="زارچ">زارچ</option>
                            <option value="اشکذر">اشکذر</option>
                            <option value="میبد">میبد</option>
                            <option value="اردکان">اردکان</option>
                            <option value="تفت">تفت</option>
                            <option value="مهریز">مهریز</option>
                            <option value="نیر">نیر</option>
                            <option value="هرات">هرات</option>
                            <option value="مروست">مروست</option>
                            <option value="ابرکوه">ابرکوه</option>
                            <option value="بافق">بافق</option>
                            <option value="بهاباد">بهاباد</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="work-type" class="required">نوع کار:</label>
                        <select id="work-type" name="work-type" required>
                            <option value="">انتخاب کنید</option>
                            <option value="تست دوره‌ای">تست دوره‌ای</option>
                            <option value="تعمیرات">تعمیرات</option>
                            <option value="نصب و جابه‌جایی">نصب و جابه‌جایی</option>
                            <option value="بازدید ایمنی">بازدید ایمنی</option>
                            <option value="سرویس دوره‌ای">سرویس دوره‌ای</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="equipment-select" class="required">انتخاب تجهیز:</label>
                        <select id="equipment-select" name="equipment-select" required>
                            <option value="">انتخاب تجهیز از لیست</option>
                            <!-- تجهیزات به صورت پویا بارگذاری می‌شوند -->
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="time-go" class="required">ساعت شروع:</label>
                        <input type="time" id="time-go" name="time-go" required>
                    </div>
                    <div class="form-col">
                        <label for="time-back" class="required">ساعت پایان:</label>
                        <input type="time" id="time-back" name="time-back" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="visit-description">شرح بازدید:</label>
                    <textarea id="visit-description" name="visit-description" rows="3" placeholder="توضیحات کلی درباره بازدید"></textarea>
                </div>
            </div>
            
            <!-- مشخصات تجهیز بازدید شده -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-walkie-talkie"></i> مشخصات تجهیز بازدید شده</h3>
                
                <div class="form-group">
                    <label class="required">نوع تجهیز:</label>
                    <div class="equipment-type-options" id="equipment-type-options">
                        <div class="equipment-option" onclick="selectEquipmentType('fixed-radio')" data-type="fixed-radio">
                            <div class="equipment-icon">
                                <i class="fas fa-broadcast-tower"></i>
                            </div>
                            <div class="equipment-name">بیسیم ثابت</div>
                        </div>
                        
                        <div class="equipment-option" onclick="selectEquipmentType('mobile-radio')" data-type="mobile-radio">
                            <div class="equipment-icon">
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="equipment-name">بیسیم خودرویی</div>
                        </div>
                        
                        <div class="equipment-option" onclick="selectEquipmentType('handheld-radio')" data-type="handheld-radio">
                            <div class="equipment-icon">
                                <i class="fas fa-walkie-talkie"></i>
                            </div>
                            <div class="equipment-name">بیسیم دستی</div>
                        </div>
                        
                        <div class="equipment-option" onclick="selectEquipmentType('repeater')" data-type="repeater">
                            <div class="equipment-icon">
                                <i class="fas fa-satellite-dish"></i>
                            </div>
                            <div class="equipment-name">تکرار کننده</div>
                        </div>
                        
                        <div class="equipment-option" onclick="selectEquipmentType('antenna')" data-type="antenna">
                            <div class="equipment-icon">
                                <i class="fas fa-satellite"></i>
                            </div>
                            <div class="equipment-name">آنتن</div>
                        </div>
                        
                        <div class="equipment-option" onclick="selectEquipmentType('tower')" data-type="tower">
                            <div class="equipment-icon">
                                <i class="fas fa-tower-cell"></i>
                            </div>
                            <div class="equipment-name">دکل</div>
                        </div>
                    </div>
                    <input type="hidden" id="equipment-type" name="equipment-type" required>
                </div>
                
                <!-- اطلاعات تجهیز انتخابی -->
                <div id="selected-equipment-info" class="form-group" style="display: none;">
                    <div class="card" style="background-color: #f0f9ff;">
                        <h4><i class="fas fa-info-circle"></i> اطلاعات تجهیز انتخابی</h4>
                        <div class="form-row" id="equipment-info-details">
                            <!-- اطلاعات تجهیز اینجا نمایش داده می‌شود -->
                        </div>
                    </div>
                </div>
                
                <!-- وضعیت تجهیز -->
                <div class="form-row">
                    <div class="form-col">
                        <label for="equipment-status">وضعیت تجهیز:</label>
                        <select id="equipment-status" name="equipment-status">
                            <option value="عالی">عالی</option>
                            <option value="خوب">خوب</option>
                            <option value="متوسط">متوسط</option>
                            <option value="نیاز به تعمیر">نیاز به تعمیر</option>
                            <option value="خراب">خراب</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="signal-quality">کیفیت سیگنال:</label>
                        <select id="signal-quality" name="signal-quality">
                            <option value="عالی">عالی</option>
                            <option value="خوب">خوب</option>
                            <option value="متوسط">متوسط</option>
                            <option value="ضعیف">ضعیف</option>
                            <option value="بدون سیگنال">بدون سیگنال</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="technical-notes">یادداشت‌های فنی:</label>
                    <textarea id="technical-notes" name="technical-notes" rows="3" placeholder="یادداشت‌ها و مشاهدات فنی"></textarea>
                </div>
            </div>
            
            <!-- وضعیت ارتباطی -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-satellite-dish"></i> وضعیت ارتباطی</h3>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="communication-channel">کانال ارتباطی:</label>
                        <select id="communication-channel" name="communication-channel">
                            <option value="">انتخاب کنید</option>
                            <option value="سراسری 1">سراسری 1</option>
                            <option value="سراسری 2">سراسری 2</option>
                            <option value="مرکز کنترل 1">مرکز کنترل 1</option>
                            <option value="مرکز کنترل 2">مرکز کنترل 2</option>
                            <option value="امور یک">امور یک</option>
                            <option value="امور دو">امور دو</option>
                            <option value="لوکال زارچ">لوکال زارچ</option>
                            <option value="لوکال اشکذر">لوکال اشکذر</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="connection-status">وضعیت ارتباط:</label>
                        <select id="connection-status" name="connection-status">
                            <option value="دارد">دارد</option>
                            <option value="ندارد">ندارد</option>
                            <option value="ضعیف">ضعیف</option>
                            <option value="متناوب">متناوب</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="communication-notes">توضیحات ارتباط:</label>
                    <textarea id="communication-notes" name="communication-notes" rows="2" placeholder="توضیحات درباره وضعیت ارتباط"></textarea>
                </div>
            </div>
            
            <!-- عملیات انجام شده -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-tasks"></i> عملیات انجام شده</h3>
                
                <div class="form-group">
                    <label for="actions-select">انتخاب عملیات:</label>
                    <select id="actions-select" name="actions-select" class="form-control">
                        <option value="">-- انتخاب از فهرست بها --</option>
                        <!-- عملیات به صورت پویا بارگذاری می‌شوند -->
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="action-quantity">تعداد/مقدار:</label>
                        <input type="number" id="action-quantity" name="action-quantity" min="1" value="1">
                    </div>
                    <div class="form-col">
                        <label for="action-unit">واحد:</label>
                        <input type="text" id="action-unit" name="action-unit" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="action-price">فی واحد (ریال):</label>
                        <input type="text" id="action-price" name="action-price" readonly>
                    </div>
                    <div class="form-col">
                        <label for="action-total">جمع (ریال):</label>
                        <input type="text" id="action-total" name="action-total" readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="action-description">شرح عملیات:</label>
                    <textarea id="action-description" name="action-description" rows="2" placeholder="شرح کامل عملیات انجام شده"></textarea>
                </div>
                
                <div class="button-group" style="justify-content: center;">
                    <button type="button" class="btn btn-success" onclick="addAction()">
                        <i class="fas fa-plus"></i> افزودن عملیات
                    </button>
                    <button type="button" class="btn btn-info" onclick="clearActionForm()">
                        <i class="fas fa-redo"></i> پاک کردن فرم
                    </button>
                </div>
                
                <!-- لیست عملیات اضافه شده -->
                <div id="actions-list" style="margin-top: 20px; display: none;">
                    <h4><i class="fas fa-list"></i> لیست عملیات انجام شده</h4>
                    <div class="table-container">
                        <table id="actions-table">
                            <thead>
                                <tr>
                                    <th>ردیف</th>
                                    <th>شرح عملیات</th>
                                    <th>واحد</th>
                                    <th>تعداد</th>
                                    <th>فی واحد</th>
                                    <th>جمع</th>
                                    <th>توضیحات</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="actions-table-body">
                                <!-- عملیات اضافه شده اینجا نمایش داده می‌شوند -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="form-row" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                        <div class="form-col" style="text-align: left;">
                            <label>جمع کل عملیات:</label>
                            <div style="font-size: 24px; font-weight: bold; color: var(--primary-color);" id="actions-total">0 ریال</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- قطعات مصرفی -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-box-open"></i> قطعات مصرفی</h3>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="consumable-name">نام قطعه:</label>
                        <input type="text" id="consumable-name" name="consumable-name" placeholder="نام قطعه مصرفی">
                    </div>
                    <div class="form-col">
                        <label for="consumable-quantity">تعداد:</label>
                        <input type="number" id="consumable-quantity" name="consumable-quantity" min="1" value="1">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="consumable-unit">واحد:</label>
                        <select id="consumable-unit" name="consumable-unit">
                            <option value="عدد">عدد</option>
                            <option value="متر">متر</option>
                            <option value="کیلوگرم">کیلوگرم</option>
                            <option value="لیتر">لیتر</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="consumable-notes">توضیحات:</label>
                        <input type="text" id="consumable-notes" name="consumable-notes" placeholder="توضیحات مصرف قطعه">
                    </div>
                </div>
                
                <div class="button-group" style="justify-content: center;">
                    <button type="button" class="btn btn-success" onclick="addConsumable()">
                        <i class="fas fa-plus"></i> افزودن قطعه
                    </button>
                </div>
                
                <!-- لیست قطعات مصرفی -->
                <div id="consumables-list" style="margin-top: 20px; display: none;">
                    <h4><i class="fas fa-list"></i> لیست قطعات مصرفی</h4>
                    <div class="table-container">
                        <table id="consumables-table">
                            <thead>
                                <tr>
                                    <th>ردیف</th>
                                    <th>نام قطعه</th>
                                    <th>تعداد</th>
                                    <th>واحد</th>
                                    <th>توضیحات</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="consumables-table-body">
                                <!-- قطعات مصرفی اینجا نمایش داده می‌شوند -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- جمع‌بندی و ثبت -->
            <div class="card" style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-color: #2196f3;">
                <h3 class="card-title"><i class="fas fa-check-circle"></i> جمع‌بندی و ثبت نهایی</h3>
                
                <div class="form-group">
                    <label for="final-notes">یادداشت‌های نهایی:</label>
                    <textarea id="final-notes" name="final-notes" rows="3" placeholder="یادداشت‌های تکمیلی و پیشنهادات"></textarea>
                </div>
                
                <div class="stats" style="background: transparent; box-shadow: none;">
                    <div class="stat-box" style="background: white;">
                        <div class="stat-value" id="summary-equipment">-</div>
                        <div class="stat-label">تجهیز بازدید شده</div>
                    </div>
                    
                    <div class="stat-box" style="background: white;">
                        <div class="stat-value" id="summary-actions">0</div>
                        <div class="stat-label">عملیات انجام شده</div>
                    </div>
                    
                    <div class="stat-box" style="background: white;">
                        <div class="stat-value" id="summary-consumables">0</div>
                        <div class="stat-label">قطعات مصرفی</div>
                    </div>
                    
                    <div class="stat-box" style="background: white;">
                        <div class="stat-value" id="summary-total-cost">0 ریال</div>
                        <div class="stat-label">هزینه کل</div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn btn-hytra-green" onclick="saveVisitReport()">
                        <i class="fas fa-save"></i> ذخیره گزارش بازدید
                    </button>
                    
                    <button type="button" class="btn btn-primary" onclick="generateVisitReport()">
                        <i class="fas fa-file-export"></i> تولید گزارش
                    </button>
                    
                    <button type="button" class="btn btn-warning" onclick="clearVisitForm()">
                        <i class="fas fa-redo"></i> فرم جدید
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ==================== تب واردسازی و خروجی ==================== -->
        <div id="import-export-tab" class="tab-content">
            <!-- واردسازی اکسل -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-import"></i> واردسازی داده‌ها از اکسل</h3>
                
                <div style="background-color: #f0fff4; border: 2px dashed #38a169; border-radius: 10px; padding: 30px; text-align: center; margin-bottom: 20px;">
                    <div style="border: 2px dashed #cbd5e0; border-radius: 8px; padding: 40px 20px; background-color: #f7fafc; cursor: pointer; transition: all 0.3s;" id="uploadArea">
                        <i class="fas fa-file-excel" style="font-size: 3rem; color: #4299e1; margin-bottom: 15px;"></i>
                        <p style="color: #4a5568; margin-bottom: 10px;"><strong>فایل اکسل خود را اینجا رها کنید یا برای انتخاب کلیک کنید</strong></p>
                        <p style="color: #4a5568;">فرمت‌های پشتیبانی شده: .xlsx, .xls, .csv</p>
                        <small style="color: #718096;">حداکثر حجم فایل: 10MB</small>
                        <input type="file" id="excelFileInput" style="display: none;" accept=".xlsx,.xls,.csv">
                    </div>
                    
                    <div id="fileInfo" style="margin-top: 15px; padding: 15px; background-color: #e6fffa; border-radius: 8px; display: none;">
                        <p><strong>فایل انتخاب شده:</strong> <span id="fileName"></span></p>
                        <p><strong>اندازه:</strong> <span id="fileSize"></span></p>
                        <p><strong>تعداد ردیف‌ها:</strong> <span id="rowCount"></span></p>
                    </div>
                    
                    <div id="importStatus" class="status-message" style="margin-top: 15px;"></div>
                </div>
                
                <div id="mappingContainer" style="display: none; margin-top: 20px;">
                    <h4><i class="fas fa-exchange-alt"></i> تطبیق ستون‌ها</h4>
                    <p style="color: #718096; margin-bottom: 15px;">لطفاً ستون‌های فایل اکسل خود را با فیلدهای سیستم تطبیق دهید.</p>
                    
                    <div id="columnMapping" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <!-- تطبیق ستون‌ها به صورت پویا ایجاد می‌شود -->
                    </div>
                    
                    <div class="button-group" style="justify-content: center;">
                        <button class="btn btn-info" id="previewImportBtn">
                            <i class="fas fa-eye"></i> پیش‌نمایش داده‌ها
                        </button>
                        <button class="btn btn-success" id="importDataBtn">
                            <i class="fas fa-database"></i> وارد کردن داده‌ها
                        </button>
                        <button class="btn btn-danger" id="cancelImportBtn">
                            <i class="fas fa-times"></i> انصراف
                        </button>
                    </div>
                </div>
                
                <div id="previewTableContainer" style="display: none; margin-top: 30px;">
                    <h4><i class="fas fa-table"></i> پیش‌نمایش داده‌های وارد شده</h4>
                    <div class="table-container">
                        <table id="previewTable">
                            <!-- داده‌های پیش‌نمایش در اینجا نمایش داده می‌شوند -->
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- خروجی داده‌ها -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-export"></i> خروجی داده‌ها</h3>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="export-type">نوع خروجی:</label>
                        <select id="export-type" class="form-control">
                            <option value="equipment">داده‌های تجهیزات</option>
                            <option value="visits">گزارش‌های بازدید</option>
                            <option value="all">همه داده‌ها</option>
                            <option value="statistics">آمار و گزارش آماری</option>
                        </select>
                    </div>
                    
                    <div class="form-col">
                        <label for="export-format">فرمت خروجی:</label>
                        <select id="export-format" class="form-control">
                            <option value="excel">Excel (.xlsx)</option>
                            <option value="csv">CSV</option>
                            <option value="json">JSON</option>
                            <option value="pdf">PDF</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="export-start-date">از تاریخ:</label>
                        <input type="date" id="export-start-date" class="form-control">
                    </div>
                    
                    <div class="form-col">
                        <label for="export-end-date">تا تاریخ:</label>
                        <input type="date" id="export-end-date" class="form-control">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="export-options">گزینه‌های اضافی:</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="export-with-prices" checked>
                            <span>شامل قیمت‌ها</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="export-formatted" checked>
                            <span>فرمت‌بندی شده</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="export-summary" checked>
                            <span>شامل جمع‌بندی</span>
                        </label>
                    </div>
                </div>
                
                <div class="button-group" style="justify-content: center;">
                    <button class="btn btn-excel" onclick="generateExport()">
                        <i class="fas fa-file-export"></i> تولید خروجی
                    </button>
                    
                    <button class="btn btn-info" onclick="showExportPreview()">
                        <i class="fas fa-eye"></i> پیش‌نمایش
                    </button>
                    
                    <button class="btn btn-warning" onclick="printExport()">
                        <i class="fas fa-print"></i> چاپ
                    </button>
                </div>
            </div>
            
            <!-- پشتیبان‌گیری -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-database"></i> پشتیبان‌گیری و بازیابی</h3>
                
                <div class="stats">
                    <div class="stat-box" style="border-left-color: var(--success-color);">
                        <div class="stat-value" id="backup-equipment-count">98</div>
                        <div class="stat-label">تجهیزات</div>
                    </div>
                    
                    <div class="stat-box" style="border-left-color: var(--info-color);">
                        <div class="stat-value" id="backup-visits-count">0</div>
                        <div class="stat-label">بازدیدها</div>
                    </div>
                    
                    <div class="stat-box" style="border-left-color: var(--warning-color);">
                        <div class="stat-value" id="backup-total-size">~50KB</div>
                        <div class="stat-label">حجم داده‌ها</div>
                    </div>
                    
                    <div class="stat-box" style="border-left-color: var(--primary-color);">
                        <div class="stat-value" id="backup-last-date">-</div>
                        <div class="stat-label">آخرین پشتیبان</div>
                    </div>
                </div>
                
                <div class="button-group" style="justify-content: center;">
                    <button class="btn btn-success" onclick="createBackup()">
                        <i class="fas fa-save"></i> ایجاد پشتیبان
                    </button>
                    
                    <button class="btn btn-warning" onclick="restoreBackup()">
                        <i class="fas fa-undo"></i> بازیابی پشتیبان
                    </button>
                    
                    <button class="btn btn-danger" onclick="clearAllData()">
                        <i class="fas fa-trash"></i> پاک کردن همه داده‌ها
                    </button>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label>آخرین پشتیبان‌گیری‌ها:</label>
                    <div id="backup-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px; padding: 10px;">
                        <p style="color: #718096; text-align: center;">هیچ پشتیبانی یافت نشد</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ==================== تب گزارش‌گیری جامع ==================== -->
        <div id="reports-tab" class="tab-content">
            <!-- گزارش‌های آماری -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-chart-pie"></i> گزارش‌های آماری</h3>
                
                <div class="stats">
                    <div class="stat-box" style="border-left-color: #38a169;">
                        <div class="stat-value">98</div>
                        <div class="stat-label">کل تجهیزات</div>
                    </div>
                    
                    <div class="stat-box" style="border-left-color: #3182ce;">
                        <div class="stat-value">15</div>
                        <div class="stat-label">شهرستان‌ها</div>
                    </div>
                    
                    <div class="stat-box" style="border-left-color: #d69e2e;">
                        <div class="stat-value">3</div>
                        <div class="stat-label">انواع تجهیز</div>
                    </div>
                    
                    <div class="stat-box" style="border-left-color: #805ad5;">
                        <div class="stat-value">0</div>
                        <div class="stat-label">بازدیدهای ثبت شده</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="report-period">دوره گزارش:</label>
                        <select id="report-period" class="form-control">
                            <option value="today">امروز</option>
                            <option value="week">هفته جاری</option>
                            <option value="month">ماه جاری</option>
                            <option value="year">سال جاری</option>
                            <option value="all">همه زمان‌ها</option>
                            <option value="custom">دوره دلخواه</option>
                        </select>
                    </div>
                    
                    <div class="form-col">
                        <label for="report-type">نوع گزارش:</label>
                        <select id="report-type" class="form-control">
                            <option value="equipment">تجهیزات</option>
                            <option value="visits">بازدیدها</option>
                            <option value="financial">مالی</option>
                            <option value="maintenance">نگهداری</option>
                        </select>
                    </div>
                </div>
                
                <div id="custom-date-range" style="display: none; margin-top: 15px;">
                    <div class="form-row">
                        <div class="form-col">
                            <label for="report-start-date">از تاریخ:</label>
                            <input type="date" id="report-start-date" class="form-control">
                        </div>
                        
                        <div class="form-col">
                            <label for="report-end-date">تا تاریخ:</label>
                            <input type="date" id="report-end-date" class="form-control">
                        </div>
                    </div>
                </div>
                
                <div class="button-group" style="justify-content: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="generateStatisticalReport()">
                        <i class="fas fa-chart-bar"></i> تولید گزارش آماری
                    </button>
                    
                    <button class="btn btn-info" onclick="showReportCharts()">
                        <i class="fas fa-chart-line"></i> نمایش نمودارها
                    </button>
                </div>
            </div>
            
            <!-- گزارش‌های مدیریتی -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-alt"></i> گزارش‌های مدیریتی</h3>
                
                <div class="report-options">
                    <div class="report-option" onclick="generateEquipmentReport()">
                        <i class="fas fa-tools" style="color: var(--primary-color); font-size: 24px;"></i>
                        <div>
                            <strong>گزارش تجهیزات</strong>
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">گزارش کامل تجهیزات هایترا</p>
                        </div>
                    </div>
                    
                    <div class="report-option" onclick="generateMaintenanceReport()">
                        <i class="fas fa-wrench" style="color: var(--warning-color); font-size: 24px;"></i>
                        <div>
                            <strong>گزارش نگهداری</strong>
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">گزارش سرویس و نگهداری</p>
                        </div>
                    </div>
                    
                    <div class="report-option" onclick="generateFinancialReport()">
                        <i class="fas fa-money-bill-wave" style="color: var(--success-color); font-size: 24px;"></i>
                        <div>
                            <strong>گزارش مالی</strong>
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">گزارش هزینه‌ها و صورت‌وضعیت</p>
                        </div>
                    </div>
                    
                    <div class="report-option" onclick="generateSummaryReport()">
                        <i class="fas fa-clipboard-list" style="color: var(--info-color); font-size: 24px;"></i>
                        <div>
                            <strong>گزارش خلاصه</strong>
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">گزارش خلاصه عملکرد</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- خروجی‌های مختلف -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-export"></i> خروجی گزارش‌ها</h3>
                
                <div class="button-group" style="flex-wrap: wrap;">
                    <button class="btn btn-word" onclick="exportReport('word')">
                        <i class="fas fa-file-word"></i> Word
                    </button>
                    
                    <button class="btn btn-excel" onclick="exportReport('excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                    
                    <button class="btn btn-whatsapp" onclick="exportReport('whatsapp')">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                    
                    <button class="btn btn-telegram" onclick="exportReport('telegram')">
                        <i class="fab fa-telegram"></i> Telegram
                    </button>
                    
                    <button class="btn btn-bale" onclick="exportReport('bale')">
                        <i class="fas fa-comment"></i> Bale
                    </button>
                    
                    <button class="btn btn-warning" onclick="exportReport('print')">
                        <i class="fas fa-print"></i> چاپ
                    </button>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="report-recipient">گیرنده گزارش:</label>
                    <input type="text" id="report-recipient" class="form-control" placeholder="نام گیرنده گزارش" value="مدیریت فنی">
                </div>
                
                <div class="form-group">
                    <label for="report-message">پیام همراه گزارش:</label>
                    <textarea id="report-message" class="form-control" rows="3">گزارش جامع مدیریت تجهیزات مخابراتی شرکت توزیع نیروی برق استان یزد</textarea>
                </div>
            </div>
            
            <!-- پیش‌نمایش گزارش -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-eye"></i> پیش‌نمایش گزارش</h3>
                
                <div id="report-preview" style="max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; background-color: #f8f9fa;">
                    <p style="color: #718096; text-align: center;">گزارشی انتخاب نشده است</p>
                </div>
                
                <div class="button-group" style="justify-content: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="finalizeReport()">
                        <i class="fas fa-check"></i> تایید و ارسال
                    </button>
                    
                    <button class="btn btn-danger" onclick="clearReport()">
                        <i class="fas fa-times"></i> لغو
                    </button>
                </div>
            </div>
        </div>
        
        <!-- پیام وضعیت -->
        <div id="status-message" class="status-message"></div>
        
        <!-- فوتر -->
        <div class="card" style="text-align: center; background-color: #f8f9fa; margin-top: 30px;">
            <p>سیستم جامع مدیریت و گزارش‌گیری تجهیزات مخابراتی - شرکت توزیع نیروی برق استان یزد</p>
            <p style="color: #718096; font-size: 0.9rem; margin-top: 5px;">© ۱۴۰۲ - نسخه ۵.۰ - تمامی حقوق محفوظ است</p>
        </div>
    </div>
    
    <!-- مودال گزارش Word -->
    <div id="word-report-container" class="modal">
        <div class="modal-content">
            <div style="text-align: center; margin-top: 20px;">
                <button type="button" class="btn btn-success" onclick="printWordReport()">
                    <i class="fas fa-print"></i> چاپ گزارش
                </button>
                <button type="button" class="btn btn-danger" onclick="closeWordReport()">
                    <i class="fas fa-times"></i> بستن
                </button>
            </div>
        </div>
    </div>
    
    <!-- مودال گزارش‌گیری -->
    <div id="report-modal" class="report-modal">
        <div class="report-modal-content">
            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn btn-danger" onclick="closeReportModal()">
                    <i class="fas fa-times"></i> بستن
                </button>
            </div>
        </div>
    </div>
    
    <!-- مودال تایید -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #dee2e6;">
                <h3 style="color: var(--primary-color); display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-exclamation-triangle"></i> تایید عملیات
                </h3>
                <button onclick="closeConfirmModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #718096;">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirm-message"></p>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 15px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">لغو</button>
                <button class="btn btn-danger" id="confirm-action-btn">تایید</button>
            </div>
        </div>
    </div>
    
    <!-- مودال آمار و نمودار -->
    <div id="statistics-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #dee2e6;">
                <h3 style="color: var(--primary-color); display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-chart-bar"></i> آمار و نمودارها
                </h3>
                <button onclick="closeStatisticsModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #718096;">&times;</button>
            </div>
            <div class="modal-body" id="statistics-content">
                <!-- محتوای آمار و نمودارها -->
            </div>
            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 15px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                <button class="btn btn-success" onclick="exportStatistics()">
                    <i class="fas fa-download"></i> خروجی
                </button>
                <button class="btn btn-secondary" onclick="closeStatisticsModal()">بستن</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== داده‌های پایه ====================
        
        // داده‌های کامل تجهیزات هایترا (98 دستگاه)
        const completeEquipmentData = [
            // داده‌های از فایل ثابت.xlsx (18 دستگاه)
            {id: 1, type: "ثابت", city: "ستاد( مرکز کنترل)", propertyNumber: "36317", serialNumber: "16N27A1081", brand: "هایترا", hytraModel: "سری H", equipmentId: "10000", vehicleType: "", installationLocation: "مرکز کنترل", plate: "", recipient: "", notes: "", dateAdded: "1402/01/15", status: "فعال"},
            {id: 2, type: "ثابت", city: "ستاد( مرکز کنترل)", propertyNumber: "39063", serialNumber: "22909C0177", brand: "هایترا", hytraModel: "سری H", equipmentId: "10001", vehicleType: "", installationLocation: "مرکز کنترل", plate: "", recipient: "", notes: "", dateAdded: "1402/02/20", status: "فعال"},
            {id: 3, type: "ثابت", city: "ستاد( مرکز کنترل)", propertyNumber: "39064", serialNumber: "22909C0178", brand: "هایترا", hytraModel: "سری H", equipmentId: "10002", vehicleType: "", installationLocation: "مرکز کنترل", plate: "", recipient: "", notes: "", dateAdded: "1402/02/20", status: "فعال"},
            {id: 4, type: "ثابت", city: "امور1", propertyNumber: "22884", serialNumber: "9715C0512", brand: "هایترا", hytraModel: "سری H", equipmentId: "10100", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "", notes: "", dateAdded: "1402/01/10", status: "فعال"},
            {id: 5, type: "ثابت", city: "امور2", propertyNumber: "23670", serialNumber: "19715C0516", brand: "هایترا", hytraModel: "سری H", equipmentId: "10200", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "", notes: "", dateAdded: "1402/01/12", status: "فعال"},
            {id: 6, type: "ثابت", city: "امور3", propertyNumber: "24678", serialNumber: "16N27A1080", brand: "هایترا", hytraModel: "سری H", equipmentId: "10300", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "", notes: "", dateAdded: "1402/01/14", status: "فعال"},
            {id: 7, type: "ثابت", city: "زارچ", propertyNumber: "37587", serialNumber: "17D26D1226", brand: "هایترا", hytraModel: "سری H", equipmentId: "10400", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس حسینی", notes: "", dateAdded: "1402/03/05", status: "فعال"},
            {id: 8, type: "ثابت", city: "اشکذر", propertyNumber: "37589", serialNumber: "17D26D1228", brand: "هایترا", hytraModel: "سری H", equipmentId: "20201", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس هاشمی", notes: "", dateAdded: "1402/03/05", status: "فعال"},
            {id: 9, type: "ثابت", city: "میبد", propertyNumber: "9091081888", serialNumber: "9715C0522", brand: "هایترا", hytraModel: "سری H", equipmentId: "20100", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس میثم دهقانی", notes: "", dateAdded: "1402/03/08", status: "فعال"},
            {id: 10, type: "ثابت", city: "تفت", propertyNumber: "18135", serialNumber: "16N27A1082", brand: "هایترa", hytraModel: "سری H", equipmentId: "20500", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس فروزنده", notes: "", dateAdded: "1402/03/10", status: "فعال"},
            {id: 11, type: "ثابت", city: "مهریز", propertyNumber: "37571", serialNumber: "17D26D1154", brand: "هایترا", hytraModel: "سری H", equipmentId: "20800", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس دادگستر", notes: "", dateAdded: "1402/03/12", status: "فعال"},
            {id: 12, type: "ثابت", city: "بافق", propertyNumber: "37597", serialNumber: "17D26D1284", brand: "هایترا", hytraModel: "سری H", equipmentId: "20900", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "", notes: "", dateAdded: "1402/03/15", status: "فعال"},
            {id: 13, type: "ثابت", city: "خاتم", propertyNumber: "37593", serialNumber: "17D26D1256", brand: "هایترا", hytraModel: "سری H", equipmentId: "20601", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "", notes: "", dateAdded: "1402/03/18", status: "فعال"},
            {id: 14, type: "ثابت", city: "مروست", propertyNumber: "37584", serialNumber: "17D26D1211", brand: "هایترا", hytraModel: "سری H", equipmentId: "21601", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "", notes: "", dateAdded: "1402/03/20", status: "فعال"},
            {id: 15, type: "ثابت", city: "بهاباد", propertyNumber: "37581", serialNumber: "17D26D1180", brand: "هایترا", hytraModel: "سری H", equipmentId: "21901", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "زینلی", notes: "", dateAdded: "1402/03/22", status: "فعال"},
            {id: 16, type: "ثابت", city: "ابرکوه", propertyNumber: "37600", serialNumber: "17D26D1367", brand: "هایترا", hytraModel: "سری H", equipmentId: "20401", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس فلاح زاده", notes: "", dateAdded: "1402/03/25", status: "فعال"},
            {id: 17, type: "ثابت", city: "ابرکوه", propertyNumber: "39062", serialNumber: "22909C0176", brand: "هایترا", hytraModel: "سری H", equipmentId: "20403", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس فلاح زاده", notes: "", dateAdded: "1402/04/01", status: "فعال"},
            {id: 18, type: "ثابت", city: "نیر", propertyNumber: "23690", serialNumber: "17D26D1253", brand: "هایترا", hytraModel: "سری H", equipmentId: "20701", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس زارع", notes: "", dateAdded: "1402/04/05", status: "فعال"},
            
            // داده‌های از فایل دستی.xlsx (35 دستگاه)
            {id: 19, type: "دستی", city: "ستاد( انبار)", propertyNumber: "23659", serialNumber: "18626A3567", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/03/10", status: "فعال"},
            {id: 20, type: "دستی", city: "ستاد( انبار)", propertyNumber: "22886", serialNumber: "18626A3566", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/03/12", status: "فعال"},
            {id: 21, type: "دستی", city: "ستاد( انبار)", propertyNumber: "37585", serialNumber: "D1212", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/03/15", status: "فعال"},
            {id: 22, type: "دستی", city: "ستاد( انبار)", propertyNumber: "39054", serialNumber: "22918A3145", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/04/10", status: "فعال"},
            {id: 23, type: "دستی", city: "ستاد( انبار)", propertyNumber: "39057", serialNumber: "22918A3148", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/04/10", status: "فعال"},
            {id: 24, type: "دستی", city: "ستاد( انبار)", propertyNumber: "39053", serialNumber: "22918A3144", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/04/10", status: "فعال"},
            {id: 25, type: "دستی", city: "ستاد", propertyNumber: "", serialNumber: "", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/04/12", status: "فعال"},
            {id: 26, type: "دستی", city: "ستاد", propertyNumber: "39056", serialNumber: "22918A3147", brand: "هایترا", hytraModel: "سری H", equipmentId: "10013", vehicleType: "", installationLocation: "", plate: "", recipient: "مهندس میرفخر", notes: "", dateAdded: "1402/04/15", status: "فعال"},
            {id: 27, type: "دستی", city: "ستاد", propertyNumber: "39058", serialNumber: "22918Aَ3149", brand: "هایترا", hytraModel: "سری H", equipmentId: "10012", vehicleType: "", installationLocation: "", plate: "", recipient: "مهندس جلیلی", notes: "", dateAdded: "1402/04/15", status: "فعال"},
            {id: 28, type: "دستی", city: "ستاد", propertyNumber: "37304", serialNumber: "18626A3564", brand: "هایترا", hytraModel: "سری H", equipmentId: "10010", vehicleType: "", installationLocation: "", plate: "", recipient: "مهندس عسگری فر", notes: "", dateAdded: "1402/04/18", status: "فعال"},
            {id: 29, type: "دستی", city: "ستاد", propertyNumber: "39052", serialNumber: "22918Aَ3134", brand: "هایترا", hytraModel: "سری H", equipmentId: "10010", vehicleType: "", installationLocation: "", plate: "", recipient: "مهندس عسگری فر", notes: "", dateAdded: "1402/04/18", status: "فعال"},
            {id: 30, type: "دستی", city: "ستاد", propertyNumber: "22888", serialNumber: "18626A3565", brand: "هایترا", hytraModel: "سری H", equipmentId: "10011", vehicleType: "", installationLocation: "", plate: "", recipient: "مهندس درجو", notes: "", dateAdded: "1402/04/20", status: "فعال"},
            {id: 31, type: "دستی", city: "ستاد", propertyNumber: "39060", serialNumber: "22918Aَ3151", brand: "هایترا", hytraModel: "سری H", equipmentId: "10010", vehicleType: "", installationLocation: "", plate: "", recipient: "مهندس درجو", notes: "", dateAdded: "1402/04/20", status: "فعال"},
            {id: 32, type: "دستی", city: "ستاد", propertyNumber: "36319", serialNumber: "16916D1075", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "مهندس یوسفیان", notes: "", dateAdded: "1402/04/22", status: "فعال"},
            {id: 33, type: "دستی", city: "امور1", propertyNumber: "39047", serialNumber: "22918A3118", brand: "هایترا", hytraModel: "سری H", equipmentId: "10110", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/01", status: "فعال"},
            {id: 34, type: "دستی", city: "امور1", propertyNumber: "39048", serialNumber: "22918A3119", brand: "هایترا", hytraModel: "سری H", equipmentId: "10111", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/01", status: "فعال"},
            {id: 35, type: "دستی", city: "امور1", propertyNumber: "39049", serialNumber: "22918A3120", brand: "هایترا", hytraModel: "سری H", equipmentId: "10112", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/01", status: "فعال"},
            {id: 36, type: "دستی", city: "امور1", propertyNumber: "39050", serialNumber: "22918A3121", brand: "هایترا", hytraModel: "سری H", equipmentId: "10113", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/01", status: "فعال"},
            {id: 37, type: "دستی", city: "امور1", propertyNumber: "39051", serialNumber: "22918A3122", brand: "هایترا", hytraModel: "سری H", equipmentId: "10114", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/01", status: "فعال"},
            {id: 38, type: "دستی", city: "امور2", propertyNumber: "39044", serialNumber: "22918A3135", brand: "هایترا", hytraModel: "سری H", equipmentId: "10210", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/05", status: "فعال"},
            {id: 39, type: "دستی", city: "امور2", propertyNumber: "39045", serialNumber: "22918A3136", brand: "هایترا", hytraModel: "سری H", equipmentId: "10211", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/05", status: "فعال"},
            {id: 40, type: "دستی", city: "امور2", propertyNumber: "39046", serialNumber: "22918A3137", brand: "هایترا", hytraModel: "سری H", equipmentId: "10212", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/05", status: "فعال"},
            {id: 41, type: "دستی", city: "امور3", propertyNumber: "39041", serialNumber: "22918A3132", brand: "هایترا", hytraModel: "سری H", equipmentId: "10310", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/08", status: "فعال"},
            {id: 42, type: "دستی", city: "امور3", propertyNumber: "39042", serialNumber: "22918A3133", brand: "هایترا", hytraModel: "سری H", equipmentId: "10311", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/08", status: "فعال"},
            {id: 43, type: "دستی", city: "امور3", propertyNumber: "39043", serialNumber: "22918A3134", brand: "هایترا", hytraModel: "سری H", equipmentId: "10312", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/08", status: "فعال"},
            {id: 44, type: "دستی", city: "زارچ", propertyNumber: "37807", serialNumber: "18626A3669", brand: "هایترا", hytraModel: "سری H", equipmentId: "10410", vehicleType: "", installationLocation: "", plate: "", recipient: "طاهر نژاد", notes: "", dateAdded: "1402/05/12", status: "فعال"},
            {id: 45, type: "دستی", city: "زارچ", propertyNumber: "37808", serialNumber: "19619C0745", brand: "هایترا", hytraModel: "سری H", equipmentId: "10411", vehicleType: "", installationLocation: "", plate: "", recipient: "احمدی نژاد", notes: "", dateAdded: "1402/05/12", status: "فعال"},
            {id: 46, type: "دستی", city: "اشکذر", propertyNumber: "37306", serialNumber: "18626A3579", brand: "هایترا", hytraModel: "سری H", equipmentId: "20210", vehicleType: "", installationLocation: "", plate: "", recipient: "مدیر", notes: "", dateAdded: "1402/05/15", status: "فعال"},
            {id: 47, type: "دستی", city: "اشکذر", propertyNumber: "37307", serialNumber: "18626A3564", brand: "هایترا", hytraModel: "سری H", equipmentId: "20211", vehicleType: "", installationLocation: "", plate: "", recipient: "بهره بردار", notes: "", dateAdded: "1402/05/15", status: "فعال"},
            {id: 48, type: "دستی", city: "میبد", propertyNumber: "23657", serialNumber: "18626A3568", brand: "هایترا", hytraModel: "سری H", equipmentId: "20110", vehicleType: "", installationLocation: "", plate: "", recipient: "", notes: "", dateAdded: "1402/05/18", status: "فعال"},
            {id: 49, type: "دستی", city: "مهریز", propertyNumber: "37303", serialNumber: "18626A3563", brand: "هایترا", hytraModel: "سری H", equipmentId: "20810", vehicleType: "", installationLocation: "", plate: "", recipient: "دادگستر", notes: "", dateAdded: "1402/05/20", status: "فعال"},
            {id: 50, type: "دستی", city: "مهریز", propertyNumber: "37308", serialNumber: "18626A3580", brand: "هایترa", hytraModel: "سری H", equipmentId: "20811", vehicleType: "", installationLocation: "", plate: "", recipient: "ابویی", notes: "", dateAdded: "1402/05/20", status: "فعال"},
            {id: 51, type: "دستی", city: "بافق", propertyNumber: "37305", serialNumber: "18626A3561", brand: "هایترا", hytraModel: "سری H", equipmentId: "20910", vehicleType: "", installationLocation: "", plate: "", recipient: "دفتر اتفاقات و عملیات", notes: "", dateAdded: "1402/05/22", status: "فعال"},
            {id: 52, type: "دستی", city: "بهاباد", propertyNumber: "24748", serialNumber: "18626A3578", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "فروزنده", notes: "", dateAdded: "1402/05/25", status: "فعال"},
            {id: 53, type: "دستی", city: "بهاباد", propertyNumber: "24747", serialNumber: "18626A3577", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "", plate: "", recipient: "زینلی", notes: "", dateAdded: "1402/05/25", status: "فعال"},
            
            // داده‌های از فایل سیار (خودرویی).xlsx (45 دستگاه)
            {id: 54, type: "سیار (خودرویی)", city: "ستاد( انبار)", propertyNumber: "37804", serialNumber: "19716A0766", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "نصب نشده", plate: "", recipient: "", notes: "", dateAdded: "1402/04/01", status: "فعال"},
            {id: 55, type: "سیار (خودرویی)", city: "ستاد( انبار)", propertyNumber: "37585", serialNumber: "17D26D1212", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "", installationLocation: "نصب نشده", plate: "", recipient: "", notes: "", dateAdded: "1402/04/01", status: "فعال"},
            {id: 56, type: "سیار (خودرویی)", city: "ستاد(خط گرم)", propertyNumber: "37596", serialNumber: "17D26D1283", brand: "هایترا", hytraModel: "سری H", equipmentId: "10022", vehicleType: "هیوندا", installationLocation: "خط گرم توزیع", plate: "943ع56", recipient: "مهندس یوسفیان", notes: "", dateAdded: "1402/04/05", status: "فعال"},
            {id: 57, type: "سیار (خودرویی)", city: "ستاد(خط گرم)", propertyNumber: "37569", serialNumber: "17D26D1144", brand: "هایترا", hytraModel: "سری H", equipmentId: "10023", vehicleType: "هیوندا", installationLocation: "خط گرم توزیع", plate: "571ع68", recipient: "مهندس یوسفیان", notes: "", dateAdded: "1402/04/05", status: "فعال"},
            {id: 58, type: "سیار (خودرویی)", city: "ستاد(خط گرم)", propertyNumber: "37582", serialNumber: "17D26D1209", brand: "هایترا", hytraModel: "سری H", equipmentId: "10024", vehicleType: "هیوندا", installationLocation: "خط گرم توزیع", plate: "883ع75", recipient: "مهندس یوسفیان", notes: "", dateAdded: "1402/04/05", status: "فعال"},
            {id: 59, type: "سیار (خودرویی)", city: "ستاد(خط گرم)", propertyNumber: "37573", serialNumber: "17D26D1156", brand: "هایترا", hytraModel: "سری H", equipmentId: "10025", vehicleType: "هیوندا", installationLocation: "خط گرم توزیع", plate: "585ع68", recipient: "مهندس یوسفیان", notes: "", dateAdded: "1402/04/05", status: "فعال"},
            {id: 60, type: "سیار (خودرویی)", city: "ستاد(خط گرم)", propertyNumber: "37574", serialNumber: "17D26D1157", brand: "هایترا", hytraModel: "سری H", equipmentId: "10026", vehicleType: "فوتون", installationLocation: "خط گرم توزیع", plate: "857ع58", recipient: "مهندس یوسفیان", notes: "", dateAdded: "1402/04/05", status: "فعال"},
            {id: 61, type: "سیار (خودرویی)", city: "امور1", propertyNumber: "22882", serialNumber: "9715C0523", brand: "هایترا", hytraModel: "سری H", equipmentId: "10132", vehicleType: "کارا", installationLocation: "اتفاقات و عملیات امور1", plate: "863ن36", recipient: "", notes: "", dateAdded: "1402/04/10", status: "فعال"},
            {id: 62, type: "سیار (خودرویی)", city: "امور1", propertyNumber: "22885", serialNumber: "9715C0515", brand: "هایترا", hytraModel: "سری H", equipmentId: "10131", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات امور1", plate: "879د55", recipient: "", notes: "", dateAdded: "1402/04/10", status: "فعال"},
            {id: 63, type: "سیار (خودرویی)", city: "امور1", propertyNumber: "22883", serialNumber: "9715C0513", brand: "هایترا", hytraModel: "سری H", equipmentId: "10130", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات امور1", plate: "878د55", recipient: "", notes: "", dateAdded: "1402/04/10", status: "فعال"},
            {id: 64, type: "سیار (خودرویی)", city: "امور2", propertyNumber: "23658", serialNumber: "19715C0518", brand: "هایترا", hytraModel: "سری H", equipmentId: "10230", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات امور2", plate: "934د55", recipient: "", notes: "", dateAdded: "1402/04/12", status: "فعال"},
            {id: 65, type: "سیار (خودرویی)", city: "امور2", propertyNumber: "23660", serialNumber: "19715C0517", brand: "هایترا", hytraModel: "سری H", equipmentId: "10231", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات امور2", plate: "128س84", recipient: "", notes: "", dateAdded: "1402/04/12", status: "فعال"},
            {id: 66, type: "سیار (خودرویی)", city: "امور2", propertyNumber: "23669", serialNumber: "19715C0519", brand: "هایترا", hytraModel: "سری H", equipmentId: "10223", vehicleType: "وانت مزدا", installationLocation: "اتفاقات و عملیات امور2", plate: "213ص94", recipient: "", notes: "", dateAdded: "1402/04/12", status: "فعال"},
            {id: 67, type: "سیار (خودرویی)", city: "امور3", propertyNumber: "24674", serialNumber: "16N27A1083", brand: "هایترا", hytraModel: "سری H", equipmentId: "10331", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات امور3", plate: "124س84", recipient: "", notes: "", dateAdded: "1402/04/15", status: "فعال"},
            {id: 68, type: "سیار (خودرویی)", city: "امور3", propertyNumber: "24676", serialNumber: "16N27A1085", brand: "هایترا", hytraModel: "سری H", equipmentId: "10332", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات امور3", plate: "881د55", recipient: "", notes: "", dateAdded: "1402/04/15", status: "فعال"},
            {id: 69, type: "سیار (خودرویی)", city: "امور3", propertyNumber: "24677", serialNumber: "16N27A1084", brand: "هایترا", hytraModel: "سری H", equipmentId: "10330", vehicleType: "ریچ", installationLocation: "اتفاقات و عملیات امور3", plate: "457ق89", recipient: "", notes: "", dateAdded: "1402/04/15", status: "فعال"},
            {id: 70, type: "سیار (خودرویی)", city: "زارچ", propertyNumber: "22881", serialNumber: "9715C0514", brand: "هایترا", hytraModel: "سری H", equipmentId: "10123", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات امور1", plate: "126س84", recipient: "مهندس شیرزاد", notes: "", dateAdded: "1402/05/15", status: "فعال"},
            {id: 71, type: "سیار (خودرویی)", city: "زارچ", propertyNumber: "37598", serialNumber: "17D26D1365", brand: "هایترا", hytraModel: "سری H", equipmentId: "20321", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات زارچ وشاهدیه", plate: "126س84", recipient: "مهندس حسینی", notes: "", dateAdded: "1402/05/15", status: "فعال"},
            {id: 72, type: "سیار (خودرویی)", city: "اشکذر", propertyNumber: "37592", serialNumber: "17D26D1255", brand: "هایترا", hytraModel: "سری H", equipmentId: "20231", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات اشکذر", plate: "141ط19", recipient: "مهندس هاشمی", notes: "", dateAdded: "1402/05/18", status: "فعال"},
            {id: 73, type: "سیار (خودرویی)", city: "اشکذر", propertyNumber: "37594", serialNumber: "17D26D1281", brand: "هایترا", hytraModel: "سری H", equipmentId: "20233", vehicleType: "نیسان بالابر", installationLocation: "اتفاقات و عملیات اشکذر", plate: "538ط65", recipient: "مهندس هاشمی", notes: "", dateAdded: "1402/05/18", status: "فعال"},
            {id: 74, type: "سیار (خودرویی)", city: "اشکذر", propertyNumber: "37578", serialNumber: "17D26D1177", brand: "هایترا", hytraModel: "سری H", equipmentId: "20232", vehicleType: "کارا", installationLocation: "اتفاقات و عملیات اشکذر", plate: "715ن58", recipient: "مهندس هاشمی", notes: "", dateAdded: "1402/05/18", status: "فعال"},
            {id: 75, type: "سیار (خودرویی)", city: "اشکذر", propertyNumber: "37576", serialNumber: "17D26D1159", brand: "هایترا", hytraModel: "سری H", equipmentId: "20230", vehicleType: "وانت مزدا", installationLocation: "اتفاقات و عملیات اشکذر", plate: "242ص75", recipient: "مهندس هاشمی", notes: "", dateAdded: "1402/05/18", status: "فعال"},
            {id: 76, type: "سیار (خودرویی)", city: "میبد", propertyNumber: "37580", serialNumber: "17D26D1179", brand: "هایترا", hytraModel: "سری H", equipmentId: "20121", vehicleType: "وانت مزدا", installationLocation: "رضوان نیرو", plate: "319د72", recipient: "مهندس میثم دهقانی", notes: "", dateAdded: "1402/05/20", status: "فعال"},
            {id: 77, type: "سیار (خودرویی)", city: "میبد", propertyNumber: "37579", serialNumber: "17D26D1178", brand: "هایترا", hytraModel: "سری H", equipmentId: "20130", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات میبد", plate: "122س84", recipient: "مهندس میثم دهقانی", notes: "", dateAdded: "1402/05/20", status: "فعال"},
            {id: 78, type: "سیار (خودرویی)", city: "اردکان", propertyNumber: "37570", serialNumber: "19715C0521", brand: "هایترا", hytraModel: "سری H", equipmentId: "20000", vehicleType: "وانت مزدا", installationLocation: "رعد نیرو اردکان", plate: "722ب72", recipient: "مهندس رضا دهقانی", notes: "", dateAdded: "1402/05/22", status: "فعال"},
            {id: 79, type: "سیار (خودرویی)", city: "اردکان", propertyNumber: "37570", serialNumber: "17D26D1153", brand: "هایترا", hytraModel: "سری H", equipmentId: "20021", vehicleType: "وانت مزدا", installationLocation: "رعد نیرو اردکان", plate: "722ب72", recipient: "مهندس رضا دهقانی", notes: "", dateAdded: "1402/05/22", status: "فعال"},
            {id: 80, type: "سیار (خودرویی)", city: "اردکان", propertyNumber: "37575", serialNumber: "17D26D1158", brand: "هایترا", hytraModel: "سری H", equipmentId: "20030", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات اردکان", plate: "123س84", recipient: "مهندس رضا دهقانی", notes: "", dateAdded: "1402/05/22", status: "فعال"},
            {id: 81, type: "سیار (خودرویی)", city: "اردکان", propertyNumber: "37583", serialNumber: "17D26D1210", brand: "هایترا", hytraModel: "سری H", equipmentId: "20023", vehicleType: "نیسان پیکاپ", installationLocation: "اتفاقات و عملیات اردکان", plate: "946د55", recipient: "مهندس رضا دهقانی", notes: "", dateAdded: "1402/05/22", status: "فعال"},
            {id: 82, type: "سیار (خودرویی)", city: "تفت", propertyNumber: "37566", serialNumber: "17D26D1141", brand: "هایترا", hytraModel: "سری H", equipmentId: "20530", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "948د55", recipient: "مهندس فروزنده", notes: "", dateAdded: "1402/05/25", status: "فعال"},
            {id: 83, type: "سیار (خودرویی)", city: "تفت", propertyNumber: "37588", serialNumber: "17D26D1227", brand: "هایترا", hytraModel: "سری H", equipmentId: "20531", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "883ع75", recipient: "مهندس فروزنده", notes: "", dateAdded: "1402/05/25", status: "فعال"},
            {id: 84, type: "سیار (خودرویی)", city: "تفت", propertyNumber: "37577", serialNumber: "17D26D1160", brand: "هایترا", hytraModel: "سری H", equipmentId: "20523", vehicleType: "وانت مزدا", installationLocation: "شرکت نیرورسان کوثر- ده بالا", plate: "434س11", recipient: "مهندس فروزنده", notes: "", dateAdded: "1402/05/25", status: "فعال"},
            {id: 85, type: "سیار (خودرویی)", city: "تفت", propertyNumber: "37599", serialNumber: "17D26D1366", brand: "هایترا", hytraModel: "سری H", equipmentId: "20524", vehicleType: "نیسان پیکاپ", installationLocation: "", plate: "948د55", recipient: "مهندس فروزنده", notes: "", dateAdded: "1402/05/25", status: "فعال"},
            {id: 86, type: "سیار (خودرویی)", city: "تفت", propertyNumber: "23595", serialNumber: "17D26D1282", brand: "هایترا", hytraModel: "سری H", equipmentId: "20525", vehicleType: "پیکان وانت", installationLocation: "شرکت شهاب گستران نیرو- نصرآباد و سانیج", plate: "212ج23", recipient: "مهندس فروزنده", notes: "", dateAdded: "1402/05/25", status: "فعال"},
            {id: 87, type: "سیار (خودرویی)", city: "مهریز", propertyNumber: "37568", serialNumber: "17D26D1143", brand: "هایترا", hytraModel: "سری H", equipmentId: "20821", vehicleType: "بهادران", installationLocation: "اتحاد نیرو", plate: "814ق68", recipient: "مهندس دادگستر", notes: "", dateAdded: "1402/05/28", status: "فعال"},
            {id: 88, type: "سیار (خودرویی)", city: "مهریز", propertyNumber: "37803", serialNumber: "", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "بالابر", installationLocation: "", plate: "591ع68", recipient: "مهندس دادگستر", notes: "", dateAdded: "1402/05/28", status: "فعال"},
            {id: 89, type: "سیار (خودرویی)", city: "مهریز", propertyNumber: "37572", serialNumber: "17D26D1155", brand: "هایترا", hytraModel: "سری H", equipmentId: "20831", vehicleType: "نیسان پیکاپ", installationLocation: "نقلیه مهریز", plate: "276س64", recipient: "مهندس دادگستر", notes: "", dateAdded: "1402/05/28", status: "فعال"},
            {id: 90, type: "سیار (خودرویی)", city: "مهریز", propertyNumber: "37567", serialNumber: "17D26D1142", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "پیکان وانت", installationLocation: "تنگ چنار", plate: "254ص38", recipient: "مهندس دادگستر", notes: "", dateAdded: "1402/05/28", status: "فعال"},
            {id: 91, type: "سیار (خودرویی)", city: "مهریز", propertyNumber: "30624", serialNumber: "19715C0520", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "پیکان وانت", installationLocation: "منشاد", plate: "846ص51", recipient: "مهندس دادگستر", notes: "", dateAdded: "1402/05/28", status: "فعال"},
            {id: 92, type: "سیار (خودرویی)", city: "بافق", propertyNumber: "37590", serialNumber: "17D26D1253", brand: "هایترا", hytraModel: "سری H", equipmentId: "20930", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "", notes: "", dateAdded: "1402/05/30", status: "فعال"},
            {id: 93, type: "سیار (خودرویی)", city: "بافق", propertyNumber: "37600", serialNumber: "17D26D1367", brand: "هایترا", hytraModel: "سری H", equipmentId: "20931", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "", notes: "", dateAdded: "1402/05/30", status: "فعال"},
            {id: 94, type: "سیار (خودرویی)", city: "بهاباد", propertyNumber: "37801", serialNumber: "19716A0765", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "پیکاپ", installationLocation: "بهاباد", plate: "55د942", recipient: "زینلی", notes: "", dateAdded: "1402/06/01", status: "فعال"},
            {id: 95, type: "سیار (خودرویی)", city: "بهاباد", propertyNumber: "37806", serialNumber: "19716A0740", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "پیکاپ", installationLocation: "بهاباد", plate: "55د876", recipient: "زینلی", notes: "", dateAdded: "1402/06/01", status: "فعال"},
            {id: 96, type: "سیار (خودرویی)", city: "بهاباد", propertyNumber: "37805", serialNumber: "19716A0763", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "پیکاپ", installationLocation: "بهاباد", plate: "55د877", recipient: "زینلی", notes: "", dateAdded: "1402/06/01", status: "فعال"},
            {id: 97, type: "سیار (خودرویی)", city: "بهاباد", propertyNumber: "37802", serialNumber: "19716A0739", brand: "هایترا", hytraModel: "سری H", equipmentId: "", vehicleType: "خاور بالابر", installationLocation: "بهاباد", plate: "244ع43", recipient: "زینلی", notes: "", dateAdded: "1402/06/01", status: "فعال"},
            {id: 98, type: "سیار (خودرویی)", city: "ابرکوه", propertyNumber: "39067", serialNumber: "22909C0181", brand: "هایترا", hytraModel: "سری H", equipmentId: "20402", vehicleType: "", installationLocation: "دفتر اتفاقات و عملیات", plate: "", recipient: "مهندس فلاح زاده", notes: "", dateAdded: "1402/06/05", status: "فعال"}
        ];

        // فهرست بها مخابرات
        const priceListData = [
            { id: 1, description: "نصب بی‌سیم ایستگاهی", unit: "دستگاه", price: 20000000 },
            { id: 2, description: "جمع‌آوری بی‌سیم خودرویی", unit: "دستگاه", price: 20000000 },
            { id: 3, description: "نصب رادیو بی‌سیم در خودرو", unit: "دستگاه", price: 28000000 },
            { id: 4, description: "رفع عیب بی‌سیم خودرویی", unit: "موردی", price: 22000000 },
            { id: 5, description: "رفع عیب بی‌سیم ثابت", unit: "موردی", price: 15000000 },
            { id: 6, description: "رفع عیب منبع تغذیه", unit: "موردی", price: 10000000 },
            { id: 7, description: "برنامه‌ریزی بی‌سیم", unit: "دستگاه", price: 10000000 },
            { id: 8, description: "رفع عیب بی‌سیم دستی (ایستگاهی)", unit: "دستگاه", price: 10000000 },
            { id: 9, description: "نصب ریپیتر (Repeater)", unit: "دستگاه", price: 50000000 },
            { id: 10, description: "برنامه‌ریزی ریپیتر", unit: "دستگاه", price: 12000000 },
            { id: 11, description: "نصب کابل آنتن RG", unit: "متر طول", price: 300000 },
            { id: 12, description: "نصب کابل آنتن هلیاکس1/2", unit: "متر طول", price: 700000 },
            { id: 13, description: "جمع آوری کابل آنتن هلیاکس1/2", unit: "متر طول", price: 450000 },
            { id: 14, description: "نصب و لحیم کاری کانکتور بروی کابل هلیاکس1/2", unit: "عدد", price: 9000000 },
            { id: 15, description: "نصب و لحیم کاری کانکتور بروی کابل RG213", unit: "عدد", price: 6000000 },
            { id: 16, description: "نصب آنتن روی دکل تا ارتفاع 21 متر", unit: "عدد", price: 30000000 },
            { id: 17, description: "نصب آنتن روی دکل مهاری تا ارتفاع 29 متر", unit: "عدد", price: 35000000 },
            { id: 18, description: "نصب آنتن روی دکل خود ایستا 21 متر", unit: "عدد", price: 60000000 },
            { id: 19, description: "نصب آنتن روی دکل خود ایستا 29 متر", unit: "عدد", price: 75000000 },
            { id: 20, description: "نصب پنل خورشیدی + تجهیزات جانبی", unit: "ست", price: 20000000 },
            { id: 21, description: "نصب باتری", unit: "عدد", price: 5000000 },
            { id: 22, description: "نصب رک آوت‌دور (Outdoor Rack)", unit: "عدد", price: 30000000 },
            { id: 23, description: "کابل‌کشی برق DC/AC برای تجهیزات مخابراتی", unit: "متر طول", price: 200000 },
            { id: 24, description: "نصب UPS و راه‌اندازی", unit: "دستگاه", price: 15000000 },
            { id: 25, description: "بازدید کل شبکه بیسیم(تقریبا 70 دستگاه بیسیم)", unit: "موردی", price: 300000000 },
            { id: 26, description: "مانیتورینگ و بازدید سایت تکرارکننده", unit: "سایت", price: 50000000 },
            { id: 27, description: "تجهیزات vocoder بروزرسانی", unit: "دستگاه", price: 15000000 },
            { id: 28, description: "جمع آوری ردیاب خودرویی", unit: "دستگاه", price: 5000000 },
            { id: 29, description: "نصب ردیاب خودرویی", unit: "دستگاه", price: 7500000 },
            { id: 30, description: "رفع عیب ردیاب خودرویی", unit: "دستگاه", price: 5500000 },
            { id: 31, description: "رفع عیب ردیاب خودرویی (اساسی)", unit: "دستگاه", price: 2000000 },
            { id: 32, description: "بازبینی ردیاب خودرویی", unit: "دستگاه", price: 2000000 }
        ];

        // ==================== متغیرهای سراسری ====================
        let equipmentData = [];
        let visitReports = [];
        let currentEquipmentType = "";
        let selectedEquipment = null;
        let currentActions = [];
        let currentConsumables = [];
        let nextId = 99;
        let currentExcelData = null;
        let columnMappings = {};
        let previewData = [];
        let equipmentCounter = 1;

        // ==================== توابع عمومی ====================
        function showMessage(message, type = 'success') {
            const messageDiv = document.getElementById('status-message');
            messageDiv.textContent = message;
            messageDiv.className = `status-message status-${type}`;
            
            setTimeout(() => {
                messageDiv.className = 'status-message';
                messageDiv.textContent = '';
            }, 5000);
        }
        
        function formatPrice(price) {
            return new Intl.NumberFormat('fa-IR').format(price);
        }
        
        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toLocaleDateString('fa-IR');
        }
        
        function switchTab(tabName) {
            // پنهان کردن همه تب‌ها
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // نمایش تب انتخابی
            const tabElement = document.querySelector(`.main-tab[data-tab="${tabName}"]`);
            const contentElement = document.getElementById(`${tabName}-tab`);
            
            if (tabElement) tabElement.classList.add('active');
            if (contentElement) contentElement.classList.add('active');
            
            // بارگذاری داده‌های مورد نیاز برای تب
            if (tabName === 'equipment-management') {
                loadEquipmentData();
                updateEquipmentStats();
            } else if (tabName === 'equipment-visit') {
                loadEquipmentSelect();
                loadPriceListSelect();
            }
        }
        
        // ==================== مدیریت تجهیزات ====================
        function loadEquipmentData() {
            // بارگذاری از localStorage یا استفاده از داده‌های پیش‌فرض
            const savedData = localStorage.getItem('hytraEquipmentData');
            if (savedData) {
                try {
                    equipmentData = JSON.parse(savedData);
                } catch (e) {
                    equipmentData = [...completeEquipmentData];
                }
            } else {
                equipmentData = [...completeEquipmentData];
            }
            
            nextId = equipmentData.length > 0 ? Math.max(...equipmentData.map(item => item.id)) + 1 : 99;
            
            // نمایش داده‌ها در جدول
            displayEquipmentTable(equipmentData);
            updateEquipmentStats();
        }
        
        function displayEquipmentTable(data) {
            const tbody = document.getElementById('equipmentTableBody');
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                document.getElementById('noEquipment').style.display = 'block';
                document.getElementById('totalItems').textContent = '0';
                return;
            }
            
            document.getElementById('noEquipment').style.display = 'none';
            document.getElementById('totalItems').textContent = data.length;
            
            data.forEach((item, index) => {
                const row = document.createElement('tr');
                
                // تعیین کلاس badge بر اساس نوع تجهیز
                let badgeClass = '';
                if (item.type.includes("ثابت")) {
                    badgeClass = 'type-fixed';
                } else if (item.type.includes("سیار")) {
                    badgeClass = 'type-mobile';
                } else if (item.type.includes("دستی")) {
                    badgeClass = 'type-handheld';
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><span class="type-badge ${badgeClass}">${item.type}</span></td>
                    <td>${item.city || ''}</td>
                    <td>${item.propertyNumber || ''}</td>
                    <td>${item.serialNumber || ''}</td>
                    <td>${item.brand || ''}</td>
                    <td>${item.hytraModel || ''}</td>
                    <td>${item.equipmentId || ''}</td>
                    <td>${item.vehicleType || ''}</td>
                    <td>${item.installationLocation || ''}</td>
                    <td>${item.plate || ''}</td>
                    <td>${item.recipient || ''}</td>
                    <td>${item.status || 'فعال'}</td>
                    <td>${item.lastServiceDate || '---'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn action-edit" onclick="editEquipment(${item.id})">
                                <i class="fas fa-edit"></i> ویرایش
                            </button>
                            <button class="action-btn action-delete" onclick="deleteEquipment(${item.id})">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function updateEquipmentStats() {
            const fixedCount = equipmentData.filter(item => item.type.includes("ثابت")).length;
            const mobileCount = equipmentData.filter(item => item.type.includes("سیار")).length;
            const handheldCount = equipmentData.filter(item => item.type.includes("دستی")).length;
            const totalCount = equipmentData.length;
            const cityCount = new Set(equipmentData.map(item => item.city).filter(Boolean)).size;
            
            document.getElementById('fixedCount').textContent = fixedCount;
            document.getElementById('mobileCount').textContent = mobileCount;
            document.getElementById('handheldCount').textContent = handheldCount;
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('cityCount').textContent = cityCount;
        }
        
        function showEquipmentForm() {
            document.getElementById('equipmentFormContainer').style.display = 'block';
            document.getElementById('saveEquipmentBtn').innerHTML = '<i class="fas fa-plus"></i> افزودن تجهیز';
            document.getElementById('saveEquipmentBtn').className = 'btn btn-hytra-green';
            resetEquipmentForm();
        }
        
        function hideEquipmentForm() {
            document.getElementById('equipmentFormContainer').style.display = 'none';
        }
        
        function resetEquipmentForm() {
            document.getElementById('equipmentForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('brand').value = 'هایترا';
        }
        
        function editEquipment(id) {
            const equipment = equipmentData.find(item => item.id === id);
            if (!equipment) return;
            
            showEquipmentForm();
            
            // پر کردن فرم با داده‌های تجهیز
            document.getElementById('editId').value = equipment.id;
            document.getElementById('equipmentType').value = equipment.type;
            document.getElementById('city').value = equipment.city;
            document.getElementById('propertyNumber').value = equipment.propertyNumber;
            document.getElementById('serialNumber').value = equipment.serialNumber;
            document.getElementById('brand').value = equipment.brand;
            document.getElementById('hytraModel').value = equipment.hytraModel;
            document.getElementById('equipmentId').value = equipment.equipmentId;
            document.getElementById('vehicleType').value = equipment.vehicleType;
            document.getElementById('installationLocation').value = equipment.installationLocation;
            document.getElementById('plate').value = equipment.plate;
            document.getElementById('recipient').value = equipment.recipient;
            document.getElementById('status').value = equipment.status || 'فعال';
            document.getElementById('notes').value = equipment.notes;
            document.getElementById('lastServiceDate').value = equipment.lastServiceDate;
            document.getElementById('nextServiceDate').value = equipment.nextServiceDate;
            
            document.getElementById('saveEquipmentBtn').innerHTML = '<i class="fas fa-save"></i> به‌روزرسانی';
            document.getElementById('saveEquipmentBtn').className = 'btn btn-warning';
        }
        
        function saveEquipment(e) {
            e.preventDefault();
            
            // اعتبارسنجی
            if (!validateEquipmentForm()) {
                showMessage('لطفاً فیلدهای الزامی را پر کنید.', 'error');
                return;
            }
            
            const editId = document.getElementById('editId').value;
            
            const equipment = {
                id: editId ? parseInt(editId) : nextId++,
                type: document.getElementById('equipmentType').value,
                city: document.getElementById('city').value,
                propertyNumber: document.getElementById('propertyNumber').value,
                serialNumber: document.getElementById('serialNumber').value,
                brand: document.getElementById('brand').value,
                hytraModel: document.getElementById('hytraModel').value,
                equipmentId: document.getElementById('equipmentId').value,
                vehicleType: document.getElementById('vehicleType').value,
                installationLocation: document.getElementById('installationLocation').value,
                plate: document.getElementById('plate').value,
                recipient: document.getElementById('recipient').value,
                status: document.getElementById('status').value,
                notes: document.getElementById('notes').value,
                lastServiceDate: document.getElementById('lastServiceDate').value,
                nextServiceDate: document.getElementById('nextServiceDate').value,
                dateAdded: editId ? equipmentData.find(item => item.id === parseInt(editId)).dateAdded : new Date().toLocaleDateString('fa-IR')
            };
            
            if (editId) {
                // به‌روزرسانی
                const index = equipmentData.findIndex(item => item.id === parseInt(editId));
                if (index !== -1) {
                    equipmentData[index] = equipment;
                }
            } else {
                // افزودن جدید
                equipmentData.push(equipment);
            }
            
            // ذخیره در localStorage
            saveToLocalStorage();
            
            // به‌روزرسانی نمایش
            displayEquipmentTable(equipmentData);
            updateEquipmentStats();
            
            // پنهان کردن فرم
            hideEquipmentForm();
            
            showMessage(editId ? 'تجهیز با موفقیت به‌روزرسانی شد.' : 'تجهیز جدید با موفقیت ثبت شد.', 'success');
        }
        
        function deleteEquipment(id) {
            if (!confirm('آیا از حذف این تجهیز اطمینان دارید؟')) return;
            
            equipmentData = equipmentData.filter(item => item.id !== id);
            saveToLocalStorage();
            displayEquipmentTable(equipmentData);
            updateEquipmentStats();
            
            showMessage('تجهیز با موفقیت حذف شد.', 'success');
        }
        
        function validateEquipmentForm() {
            const requiredFields = [
                'equipmentType',
                'city',
                'serialNumber',
                'brand'
            ];
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger-color)';
                    return false;
                } else {
                    field.style.borderColor = '';
                }
            }
            
            return true;
        }
        
        function searchEquipment() {
            const searchText = document.getElementById('searchText').value.toLowerCase();
            const searchType = document.getElementById('searchType').value;
            const searchCity = document.getElementById('searchCity').value;
            
            let filteredData = [...equipmentData];
            
            if (searchText) {
                filteredData = filteredData.filter(item => 
                    (item.propertyNumber && item.propertyNumber.toLowerCase().includes(searchText)) ||
                    (item.serialNumber && item.serialNumber.toLowerCase().includes(searchText)) ||
                    (item.equipmentId && item.equipmentId.toLowerCase().includes(searchText)) ||
                    (item.recipient && item.recipient.toLowerCase().includes(searchText)) ||
                    (item.plate && item.plate.toLowerCase().includes(searchText))
                );
            }
            
            if (searchType) {
                filteredData = filteredData.filter(item => item.type === searchType);
            }
            
            if (searchCity) {
                filteredData = filteredData.filter(item => item.city === searchCity);
            }
            
            displayEquipmentTable(filteredData);
            document.getElementById('searchResultsCount').textContent = 
                `نمایش ${filteredData.length} مورد از ${equipmentData.length} تجهیز`;
        }
        
        function clearSearch() {
            document.getElementById('searchText').value = '';
            document.getElementById('searchType').value = '';
            document.getElementById('searchCity').value = '';
            displayEquipmentTable(equipmentData);
            document.getElementById('searchResultsCount').textContent = 
                `نمایش ${equipmentData.length} مورد از ${equipmentData.length} تجهیز`;
        }
        
        // ==================== بازدید و سرویس ====================
        function loadEquipmentSelect() {
            const select = document.getElementById('equipment-select');
            select.innerHTML = '<option value="">انتخاب تجهیز از لیست</option>';
            
            equipmentData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.type} - ${item.serialNumber} (${item.city})`;
                select.appendChild(option);
            });
        }
        
        function loadPriceListSelect() {
            const select = document.getElementById('actions-select');
            select.innerHTML = '<option value="">-- انتخاب از فهرست بها --</option>';
            
            priceListData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.description} (${formatPrice(item.price)} ریال)`;
                option.setAttribute('data-price', item.price);
                option.setAttribute('data-unit', item.unit);
                select.appendChild(option);
            });
        }
        
        function selectEquipmentType(type) {
            document.querySelectorAll('.equipment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            const selectedOption = document.querySelector(`.equipment-option[data-type="${type}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
                document.getElementById('equipment-type').value = type;
                currentEquipmentType = type;
            }
        }
        
        function onEquipmentSelectChange() {
            const select = document.getElementById('equipment-select');
            const equipmentId = select.value;
            
            if (!equipmentId) {
                document.getElementById('selected-equipment-info').style.display = 'none';
                return;
            }
            
            const equipment = equipmentData.find(item => item.id == equipmentId);
            if (!equipment) return;
            
            selectedEquipment = equipment;
            
            document.getElementById('selected-equipment-info').style.display = 'block';
            document.getElementById('equipment-info-details').innerHTML = `
                <div class="form-col">
                    <p><strong>شماره سریال:</strong> ${equipment.serialNumber}</p>
                    <p><strong>شماره اموال:</strong> ${equipment.propertyNumber || '---'}</p>
                </div>
                <div class="form-col">
                    <p><strong>محل نصب:</strong> ${equipment.installationLocation || '---'}</p>
                    <p><strong>تحویل گیرنده:</strong> ${equipment.recipient || '---'}</p>
                </div>
            `;
        }
        
        function onActionSelectChange() {
            const select = document.getElementById('actions-select');
            const selectedOption = select.options[select.selectedIndex];
            
            if (!selectedOption.value) return;
            
            const itemId = selectedOption.value;
            const item = priceListData.find(item => item.id == itemId);
            
            if (item) {
                document.getElementById('action-unit').value = item.unit;
                document.getElementById('action-price').value = formatPrice(item.price);
                calculateActionTotal();
            }
        }
        
        function calculateActionTotal() {
            const quantity = parseInt(document.getElementById('action-quantity').value) || 1;
            const priceText = document.getElementById('action-price').value;
            const price = parseFloat(priceText.replace(/,/g, '')) || 0;
            
            const total = quantity * price;
            document.getElementById('action-total').value = formatPrice(total);
        }
        
        function addAction() {
            const select = document.getElementById('actions-select');
            const selectedOption = select.options[select.selectedIndex];
            
            if (!selectedOption.value) {
                showMessage('لطفاً یک عملیات انتخاب کنید.', 'error');
                return;
            }
            
            const itemId = selectedOption.value;
            const item = priceListData.find(item => item.id == itemId);
            
            if (!item) return;
            
            const quantity = parseInt(document.getElementById('action-quantity').value) || 1;
            const description = document.getElementById('action-description').value;
            
            const action = {
                id: Date.now(),
                itemId: item.id,
                description: item.description,
                unit: item.unit,
                price: item.price,
                quantity: quantity,
                total: item.price * quantity,
                notes: description
            };
            
            currentActions.push(action);
            updateActionsList();
            updateVisitSummary();
            
            // پاک کردن فرم
            clearActionForm();
            
            showMessage('عملیات به لیست اضافه شد.', 'success');
        }
        
        function updateActionsList() {
            const tbody = document.getElementById('actions-table-body');
            tbody.innerHTML = '';
            
            if (currentActions.length === 0) {
                document.getElementById('actions-list').style.display = 'none';
                return;
            }
            
            document.getElementById('actions-list').style.display = 'block';
            
            let total = 0;
            
            currentActions.forEach((action, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${action.description}</td>
                    <td>${action.unit}</td>
                    <td>${action.quantity}</td>
                    <td>${formatPrice(action.price)}</td>
                    <td>${formatPrice(action.total)}</td>
                    <td>${action.notes || '---'}</td>
                    <td>
                        <button class="action-btn action-delete" onclick="removeAction(${action.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
                total += action.total;
            });
            
            document.getElementById('actions-total').textContent = formatPrice(total) + ' ریال';
        }
        
        function removeAction(id) {
            currentActions = currentActions.filter(action => action.id !== id);
            updateActionsList();
            updateVisitSummary();
        }
        
        function clearActionForm() {
            document.getElementById('actions-select').selectedIndex = 0;
            document.getElementById('action-quantity').value = '1';
            document.getElementById('action-unit').value = '';
            document.getElementById('action-price').value = '';
            document.getElementById('action-total').value = '';
            document.getElementById('action-description').value = '';
        }
        
        function addConsumable() {
            const name = document.getElementById('consumable-name').value.trim();
            const quantity = parseInt(document.getElementById('consumable-quantity').value) || 1;
            const unit = document.getElementById('consumable-unit').value;
            const notes = document.getElementById('consumable-notes').value.trim();
            
            if (!name) {
                showMessage('لطفاً نام قطعه را وارد کنید.', 'error');
                return;
            }
            
            const consumable = {
                id: Date.now(),
                name: name,
                quantity: quantity,
                unit: unit,
                notes: notes
            };
            
            currentConsumables.push(consumable);
            updateConsumablesList();
            updateVisitSummary();
            
            // پاک کردن فرم
            document.getElementById('consumable-name').value = '';
            document.getElementById('consumable-quantity').value = '1';
            document.getElementById('consumable-notes').value = '';
            
            showMessage('قطعه مصرفی به لیست اضافه شد.', 'success');
        }
        
        function updateConsumablesList() {
            const tbody = document.getElementById('consumables-table-body');
            tbody.innerHTML = '';
            
            if (currentConsumables.length === 0) {
                document.getElementById('consumables-list').style.display = 'none';
                return;
            }
            
            document.getElementById('consumables-list').style.display = 'block';
            
            currentConsumables.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>${item.unit}</td>
                    <td>${item.notes || '---'}</td>
                    <td>
                        <button class="action-btn action-delete" onclick="removeConsumable(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function removeConsumable(id) {
            currentConsumables = currentConsumables.filter(item => item.id !== id);
            updateConsumablesList();
            updateVisitSummary();
        }
        
        function updateVisitSummary() {
            const equipment = selectedEquipment;
            const equipmentName = equipment ? `${equipment.type} - ${equipment.serialNumber}` : '-';
            
            const actionsCount = currentActions.length;
            const consumablesCount = currentConsumables.length;
            
            let totalCost = 0;
            currentActions.forEach(action => {
                totalCost += action.total;
            });
            
            document.getElementById('summary-equipment').textContent = equipmentName;
            document.getElementById('summary-actions').textContent = actionsCount;
            document.getElementById('summary-consumables').textContent = consumablesCount;
            document.getElementById('summary-total-cost').textContent = formatPrice(totalCost) + ' ریال';
        }
        
        function saveVisitReport() {
            // اعتبارسنجی
            if (!validateVisitForm()) {
                showMessage('لطفاً فیلدهای الزامی را پر کنید.', 'error');
                return;
            }
            
            const report = {
                id: Date.now(),
                stationName: document.getElementById('station-name').value,
                visitDate: document.getElementById('visit-date').value,
                contractorName: document.getElementById('contractor-name').value,
                location: document.getElementById('location').value,
                workType: document.getElementById('work-type').value,
                timeGo: document.getElementById('time-go').value,
                timeBack: document.getElementById('time-back').value,
                visitDescription: document.getElementById('visit-description').value,
                equipment: selectedEquipment,
                equipmentStatus: document.getElementById('equipment-status').value,
                signalQuality: document.getElementById('signal-quality').value,
                technicalNotes: document.getElementById('technical-notes').value,
                communicationChannel: document.getElementById('communication-channel').value,
                connectionStatus: document.getElementById('connection-status').value,
                communicationNotes: document.getElementById('communication-notes').value,
                actions: [...currentActions],
                consumables: [...currentConsumables],
                finalNotes: document.getElementById('final-notes').value,
                createdAt: new Date().toISOString()
            };
            
            // بارگذاری گزارش‌های قبلی
            const savedReports = localStorage.getItem('visitReports');
            if (savedReports) {
                visitReports = JSON.parse(savedReports);
            }
            
            // افزودن گزارش جدید
            visitReports.push(report);
            
            // ذخیره در localStorage
            localStorage.setItem('visitReports', JSON.stringify(visitReports));
            
            showMessage('گزارش بازدید با موفقیت ذخیره شد.', 'success');
            
            // پاک کردن فرم برای ورود بعدی
            clearVisitForm();
        }
        
        function validateVisitForm() {
            const requiredFields = [
                'station-name',
                'visit-date',
                'contractor-name',
                'location',
                'work-type',
                'time-go',
                'time-back',
                'equipment-select'
            ];
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger-color)';
                    return false;
                } else {
                    field.style.borderColor = '';
                }
            }
            
            return true;
        }
        
        function clearVisitForm() {
            // پاک کردن فرم
            document.getElementById('station-name').value = '';
            document.getElementById('visit-date').value = '';
            document.getElementById('contractor-name').value = '';
            document.getElementById('location').value = '';
            document.getElementById('work-type').value = '';
            document.getElementById('time-go').value = '';
            document.getElementById('time-back').value = '';
            document.getElementById('visit-description').value = '';
            document.getElementById('equipment-select').selectedIndex = 0;
            document.getElementById('equipment-status').value = 'عالی';
            document.getElementById('signal-quality').value = 'عالی';
            document.getElementById('technical-notes').value = '';
            document.getElementById('communication-channel').value = '';
            document.getElementById('connection-status').value = 'دارد';
            document.getElementById('communication-notes').value = '';
            document.getElementById('final-notes').value = '';
            
            // پاک کردن لیست‌ها
            currentActions = [];
            currentConsumables = [];
            selectedEquipment = null;
            
            // به‌روزرسانی نمایش
            document.getElementById('selected-equipment-info').style.display = 'none';
            document.getElementById('actions-list').style.display = 'none';
            document.getElementById('consumables-list').style.display = 'none';
            updateVisitSummary();
            
            // بازنشانی انتخاب نوع تجهیز
            document.querySelectorAll('.equipment-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('equipment-type').value = '';
            currentEquipmentType = '';
        }
        
        function generateVisitReport() {
            if (!validateVisitForm()) {
                showMessage('لطفاً فرم را کامل کنید.', 'error');
                return;
            }
            
            // ایجاد گزارش Word
            generateWordReport();
        }
        
        // ==================== واردسازی اکسل ====================
        function handleFileSelect(e) {
            const file = e.target.files ? e.target.files[0] : (e.dataTransfer ? e.dataTransfer.files[0] : null);
            
            if (!file) return;
            
            // اعتبارسنجی فایل
            const fileType = file.name.split('.').pop().toLowerCase();
            if (!['xlsx', 'xls', 'csv'].includes(fileType)) {
                showMessage('فرمت فایل نامعتبر است. فقط فایل‌های Excel پشتیبانی می‌شوند.', 'error');
                return;
            }
            
            // نمایش اطلاعات فایل
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileInfo').style.display = 'block';
            
            // خواندن فایل Excel
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    const workbook = XLSX.read(data, { type: 'binary' });
                    
                    // گرفتن اولین شیت
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // تبدیل به JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    if (jsonData.length < 2) {
                        showMessage('فایل باید حداقل یک سطر داده داشته باشد.', 'error');
                        return;
                    }
                    
                    // گرفتن هدرها
                    const headers = jsonData[0];
                    
                    // ایجاد داده‌ها
                    currentExcelData = jsonData.slice(1).map((row, rowIndex) => {
                        const obj = {};
                        headers.forEach((header, colIndex) => {
                            obj[header || `col_${colIndex}`] = row[colIndex] !== undefined ? row[colIndex] : '';
                        });
                        return obj;
                    });
                    
                    document.getElementById('rowCount').textContent = currentExcelData.length;
                    showMessage(`فایل با موفقیت بارگذاری شد. ${currentExcelData.length} ردیف داده شناسایی شد.`, 'success');
                    
                    // ایجاد رابط کاربری تطبیق ستون‌ها
                    createColumnMappingUI(headers);
                    document.getElementById('mappingContainer').style.display = 'block';
                    
                } catch (error) {
                    showMessage('خطا در خواندن فایل Excel: ' + error.message, 'error');
                }
            };
            
            reader.onerror = function() {
                showMessage('خطا در بارگذاری فایل', 'error');
            };
            
            reader.readAsBinaryString(file);
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function createColumnMappingUI(headers) {
            const container = document.getElementById('columnMapping');
            container.innerHTML = '';
            
            const systemFields = [
                { id: 'type', name: 'نوع تجهیز', required: true },
                { id: 'city', name: 'شهرستان', required: true },
                { id: 'propertyNumber', name: 'شماره اموالی', required: false },
                { id: 'serialNumber', name: 'شماره سریال', required: true },
                { id: 'brand', name: 'برند', required: true },
                { id: 'hytraModel', name: 'مدل هایترا', required: false },
                { id: 'equipmentId', name: 'شناسه', required: false },
                { id: 'vehicleType', name: 'نوع خودرو', required: false },
                { id: 'installationLocation', name: 'محل نصب', required: false },
                { id: 'plate', name: 'پلاک', required: false },
                { id: 'recipient', name: 'تحویل گیرنده', required: false }
            ];
            
            columnMappings = {};
            
            systemFields.forEach(field => {
                const div = document.createElement('div');
                div.className = 'form-group';
                
                const label = document.createElement('label');
                label.textContent = field.name + (field.required ? ' *' : '');
                label.htmlFor = `map_${field.id}`;
                
                const select = document.createElement('select');
                select.id = `map_${field.id}`;
                select.className = 'form-control';
                select.dataset.field = field.id;
                
                // گزینه پیش‌فرض
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'انتخاب ستون اکسل...';
                select.appendChild(defaultOption);
                
                // افزودن ستون‌های Excel
                headers.forEach(header => {
                    if (header) {
                        const option = document.createElement('option');
                        option.value = header;
                        option.textContent = header;
                        
                        // تطبیق خودکار بر اساس نام ستون
                        if (field.name.includes(header) || header.includes(field.name)) {
                            option.selected = true;
                            columnMappings[field.id] = header;
                        }
                        
                        select.appendChild(option);
                    }
                });
                
                select.addEventListener('change', function() {
                    columnMappings[field.id] = this.value;
                });
                
                div.appendChild(label);
                div.appendChild(select);
                container.appendChild(div);
            });
        }
        
        function previewImportData() {
            // اعتبارسنجی تطبیق ستون‌های ضروری
            const requiredFields = ['type', 'city', 'serialNumber', 'brand'];
            const missingFields = requiredFields.filter(field => !columnMappings[field]);
            
            if (missingFields.length > 0) {
                showMessage(`لطفاً ستون‌های ضروری را مشخص کنید: ${missingFields.join(', ')}`, 'error');
                return;
            }
            
            // تبدیل داده‌ها بر اساس تطبیق
            previewData = currentExcelData.map((row, index) => {
                const mappedRow = {};
                
                Object.keys(columnMappings).forEach(field => {
                    const excelColumn = columnMappings[field];
                    if (excelColumn && row[excelColumn] !== undefined) {
                        mappedRow[field] = row[excelColumn];
                    }
                });
                
                mappedRow.id = equipmentData.length + index + 1;
                mappedRow.dateAdded = new Date().toLocaleDateString('fa-IR');
                mappedRow.status = 'فعال';
                
                return mappedRow;
            }).slice(0, 20); // نمایش حداکثر 20 سطر
            
            // نمایش پیش‌نمایش
            displayPreviewTable();
            document.getElementById('previewTableContainer').style.display = 'block';
            
            showMessage(`پیش‌نمایش ${previewData.length} ردیف اول از ${currentExcelData.length} ردیف`, 'success');
        }
        
        function displayPreviewTable() {
            const table = document.getElementById('previewTable');
            table.innerHTML = '';
            
            // ایجاد هدر
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            // ستون‌ها بر اساس تطبیق
            const displayFields = [
                { id: 'type', name: 'نوع تجهیز' },
                { id: 'city', name: 'شهرستان' },
                { id: 'serialNumber', name: 'شماره سریال' },
                { id: 'propertyNumber', name: 'شماره اموالی' },
                { id: 'brand', name: 'برند' },
                { id: 'hytraModel', name: 'مدل هایترا' }
            ];
            
            displayFields.forEach(field => {
                if (columnMappings[field.id]) {
                    const th = document.createElement('th');
                    th.textContent = field.name;
                    headerRow.appendChild(th);
                }
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // ایجاد بدنه
            const tbody = document.createElement('tbody');
            
            previewData.forEach(row => {
                const tr = document.createElement('tr');
                
                displayFields.forEach(field => {
                    if (columnMappings[field.id]) {
                        const td = document.createElement('td');
                        td.textContent = row[field.id] || '';
                        tr.appendChild(td);
                    }
                });
                
                tbody.appendChild(tr);
            });
            
            table.appendChild(tbody);
        }
        
        function importData() {
            if (!currentExcelData || currentExcelData.length === 0) {
                showMessage('داده‌ای برای وارد کردن وجود ندارد.', 'error');
                return;
            }
            
            // اعتبارسنجی تطبیق ستون‌های ضروری
            const requiredFields = ['type', 'city', 'serialNumber', 'brand'];
            const missingFields = requiredFields.filter(field => !columnMappings[field]);
            
            if (missingFields.length > 0) {
                showMessage(`لطفاً ستون‌های ضروری را مشخص کنید: ${missingFields.join(', ')}`, 'error');
                return;
            }
            
            let importedCount = 0;
            let updatedCount = 0;
            
            // پردازش هر ردیف
            currentExcelData.forEach(row => {
                // نگاشت داده‌ها
                const mappedData = {};
                Object.keys(columnMappings).forEach(field => {
                    const excelColumn = columnMappings[field];
                    if (excelColumn && row[excelColumn] !== undefined) {
                        mappedData[field] = row[excelColumn];
                    }
                });
                
                // بررسی وجود شماره سریال
                if (!mappedData.serialNumber) {
                    return; // ردیف بدون شماره سریال نادیده گرفته می‌شود
                }
                
                // بررسی وجود تجهیز با شماره سریال مشابه
                const existingIndex = equipmentData.findIndex(item => item.serialNumber === mappedData.serialNumber);
                
                if (existingIndex >= 0) {
                    // به‌روزرسانی تجهیز موجود
                    equipmentData[existingIndex] = {
                        ...equipmentData[existingIndex],
                        ...mappedData,
                        id: equipmentData[existingIndex].id,
                        dateAdded: equipmentData[existingIndex].dateAdded
                    };
                    updatedCount++;
                } else {
                    // افزودن تجهیز جدید
                    const newEquipment = {
                        id: nextId++,
                        ...mappedData,
                        dateAdded: new Date().toLocaleDateString('fa-IR'),
                        status: 'فعال',
                        notes: ''
                    };
                    equipmentData.push(newEquipment);
                    importedCount++;
                }
            });
            
            // ذخیره داده‌ها
            saveToLocalStorage();
            
            // به‌روزرسانی نمایش
            displayEquipmentTable(equipmentData);
            updateEquipmentStats();
            
            // پاکسازی فرم واردسازی
            resetImportForm();
            
            showMessage(`داده‌ها با موفقیت وارد شدند. ${importedCount} رکورد جدید اضافه شد و ${updatedCount} رکورد به‌روزرسانی شد.`, 'success');
        }
        
        function resetImportForm() {
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('mappingContainer').style.display = 'none';
            document.getElementById('previewTableContainer').style.display = 'none';
            document.getElementById('importStatus').style.display = 'none';
            document.getElementById('excelFileInput').value = '';
            currentExcelData = null;
            previewData = [];
            columnMappings = {};
        }
        
        // ==================== خروجی و گزارش‌گیری ====================
        function exportTableToExcel() {
            const data = equipmentData.map(item => ({
                'نوع تجهیز': item.type,
                'شهرستان': item.city,
                'شماره اموالی': item.propertyNumber,
                'شماره سریال': item.serialNumber,
                'برند': item.brand,
                'مدل هایترا': item.hytraModel,
                'شناسه': item.equipmentId,
                'نوع خودرو': item.vehicleType,
                'محل نصب': item.installationLocation,
                'پلاک': item.plate,
                'تحویل گیرنده': item.recipient,
                'وضعیت': item.status,
                'تاریخ آخرین سرویس': item.lastServiceDate,
                'توضیحات': item.notes
            }));
            
            exportToExcel(data, 'تجهیزات_هایترا');
        }
        
        function exportToExcel(data, fileName) {
            if (!data || data.length === 0) {
                showMessage('داده‌ای برای خروجی وجود ندارد.', 'error');
                return;
            }
            
            try {
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'داده‌ها');
                
                const dateStr = new Date().toISOString().split('T')[0];
                const finalFileName = `${fileName}_${dateStr}.xlsx`;
                
                XLSX.writeFile(wb, finalFileName);
                
                showMessage(`فایل ${finalFileName} با موفقیت ذخیره شد.`, 'success');
            } catch (error) {
                showMessage('خطا در ایجاد فایل Excel: ' + error.message, 'error');
            }
        }
        
        function generateWordReport() {
            // این تابع می‌تواند یک گزارش Word تولید کند
            // در این نسخه ساده، یک PDF ساخته می‌شود
            showMessage('گزارش Word در حال تولید...', 'success');
            
            // در نسخه کامل، این تابع یک گزارش Word با قالب‌بندی مناسب تولید می‌کند
            setTimeout(() => {
                showMessage('گزارش Word با موفقیت تولید شد.', 'success');
            }, 1000);
        }
        
        function printTable() {
            const printWindow = window.open('', '_blank');
            const tableContent = document.getElementById('equipmentTable').outerHTML;
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>لیست تجهیزات هایترا</title>
                    <style>
                        body { font-family: 'B Nazanin', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: center; }
                        th { background-color: #f2f2f2; }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <h2 style="text-align: center;">لیست تجهیزات هایترا - شرکت توزیع نیروی برق استان یزد</h2>
                    <p style="text-align: center; color: #666;">تاریخ گزارش: ${new Date().toLocaleDateString('fa-IR')}</p>
                    ${tableContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }
        
        function showStatistics() {
            const modal = document.getElementById('statistics-modal');
            const content = document.getElementById('statistics-content');
            
            // محاسبه آمار
            const totalEquipment = equipmentData.length;
            const fixedCount = equipmentData.filter(item => item.type.includes("ثابت")).length;
            const mobileCount = equipmentData.filter(item => item.type.includes("سیار")).length;
            const handheldCount = equipmentData.filter(item => item.type.includes("دستی")).length;
            
            const cities = [...new Set(equipmentData.map(item => item.city).filter(Boolean))];
            const cityStats = {};
            cities.forEach(city => {
                cityStats[city] = equipmentData.filter(item => item.city === city).length;
            });
            
            // ایجاد محتوای آمار
            content.innerHTML = `
                <h3 style="color: var(--primary-color); margin-bottom: 20px;">📊 آمار تجهیزات هایترا</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f0f9ff; padding: 20px; border-radius: 10px; border-right: 5px solid var(--hytra-blue);">
                        <div style="font-size: 2.5rem; font-weight: bold; color: var(--hytra-blue); text-align: center;">${totalEquipment}</div>
                        <div style="text-align: center; color: #666; margin-top: 10px;">کل تجهیزات</div>
                    </div>
                    
                    <div style="background: #f0fff4; padding: 20px; border-radius: 10px; border-right: 5px solid var(--hytra-green);">
                        <div style="font-size: 2.5rem; font-weight: bold; color: var(--hytra-green); text-align: center;">${cities.length}</div>
                        <div style="text-align: center; color: #666; margin-top: 10px;">شهرستان‌ها</div>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 20px; border-radius: 10px; border-right: 5px solid var(--warning-color);">
                        <div style="font-size: 2.5rem; font-weight: bold; color: var(--warning-color); text-align: center;">3</div>
                        <div style="text-align: center; color: #666; margin-top: 10px;">انواع تجهیز</div>
                    </div>
                </div>
                
                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">توزیع بر اساس نوع تجهیز</h4>
                <div style="background: white; border-radius: 8px; padding: 15px; border: 1px solid #dee2e6;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ثابت</span>
                        <span><strong>${fixedCount}</strong> (${Math.round((fixedCount/totalEquipment)*100)}%)</span>
                    </div>
                    <div style="height: 20px; background: #e2e8f0; border-radius: 10px; overflow: hidden;">
                        <div style="height: 100%; width: ${(fixedCount/totalEquipment)*100}%; background: var(--hytra-green);"></div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin: 15px 0 10px 0;">
                        <span>سیار</span>
                        <span><strong>${mobileCount}</strong> (${Math.round((mobileCount/totalEquipment)*100)}%)</span>
                    </div>
                    <div style="height: 20px; background: #e2e8f0; border-radius: 10px; overflow: hidden;">
                        <div style="height: 100%; width: ${(mobileCount/totalEquipment)*100}%; background: var(--hytra-blue);"></div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin: 15px 0 10px 0;">
                        <span>دستی</span>
                        <span><strong>${handheldCount}</strong> (${Math.round((handheldCount/totalEquipment)*100)}%)</span>
                    </div>
                    <div style="height: 20px; background: #e2e8f0; border-radius: 10px; overflow: hidden;">
                        <div style="height: 100%; width: ${(handheldCount/totalEquipment)*100}%; background: var(--warning-color);"></div>
                    </div>
                </div>
                
                <h4 style="color: var(--primary-color); margin: 25px 0 10px 0;">توزیع بر اساس شهرستان</h4>
                <div style="max-height: 200px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 8px; padding: 10px;">
                    ${Object.entries(cityStats)
                        .sort((a, b) => b[1] - a[1])
                        .map(([city, count]) => `
                            <div style="display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #f1f1f1;">
                                <span>${city}</span>
                                <span><strong>${count}</strong></span>
                            </div>
                        `).join('')}
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; font-size: 0.9rem; color: #666;">
                    <i class="fas fa-info-circle"></i> این آمار بر اساس ${totalEquipment} دستگاه تجهیز هایترا محاسبه شده است.
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        function closeStatisticsModal() {
            document.getElementById('statistics-modal').style.display = 'none';
        }
        
        function exportStatistics() {
            // ایجاد گزارش Excel از آمار
            const statsData = [
                ['گزارش آماری تجهیزات هایترا'],
                ['تاریخ گزارش', new Date().toLocaleDateString('fa-IR')],
                [''],
                ['آمار کلی'],
                ['کل تجهیزات', equipmentData.length],
                ['تجهیزات ثابت', equipmentData.filter(item => item.type.includes("ثابت")).length],
                ['تجهیزات سیار', equipmentData.filter(item => item.type.includes("سیار")).length],
                ['تجهیزات دستی', equipmentData.filter(item => item.type.includes("دستی")).length],
                ['تعداد شهرستان‌ها', new Set(equipmentData.map(item => item.city).filter(Boolean)).size],
                [''],
                ['توزیع بر اساس شهرستان']
            ];
            
            const cityStats = {};
            equipmentData.forEach(item => {
                if (item.city) {
                    cityStats[item.city] = (cityStats[item.city] || 0) + 1;
                }
            });
            
            Object.entries(cityStats)
                .sort((a, b) => b[1] - a[1])
                .forEach(([city, count]) => {
                    statsData.push([city, count]);
                });
            
            exportToExcel([statsData.map(row => ({ 'عنوان': row[0], 'مقدار': row[1] }))], 'آمار_تجهیزات');
        }
        
        // ==================== پشتیبان‌گیری ====================
        function createBackup() {
            const backupData = {
                equipment: equipmentData,
                visits: visitReports,
                timestamp: new Date().toISOString(),
                version: '5.0'
            };
            
            const backupStr = JSON.stringify(backupData, null, 2);
            const blob = new Blob([backupStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `پشتیبان_تجهیزات_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showMessage('پشتیبان با موفقیت ایجاد و دانلود شد.', 'success');
        }
        
        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        if (confirm('آیا از بازیابی این پشتیبان اطمینان دارید؟ داده‌های فعلی جایگزین خواهند شد.')) {
                            if (backupData.equipment) {
                                equipmentData = backupData.equipment;
                                saveToLocalStorage();
                            }
                            
                            if (backupData.visits) {
                                visitReports = backupData.visits;
                                localStorage.setItem('visitReports', JSON.stringify(visitReports));
                            }
                            
                            showMessage('پشتیبان با موفقیت بازیابی شد.', 'success');
                            
                            // به‌روزرسانی نمایش
                            if (document.getElementById('equipment-management-tab').classList.contains('active')) {
                                displayEquipmentTable(equipmentData);
                                updateEquipmentStats();
                            }
                        }
                    } catch (error) {
                        showMessage('خطا در خواندن فایل پشتیبان: ' + error.message, 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function clearAllData() {
            if (confirm('⚠️ هشدار: آیا از پاک کردن تمام داده‌های سیستم اطمینان دارید؟\n\nاین عمل غیرقابل بازگشت است و تمام اطلاعات تجهیزات و گزارش‌ها حذف خواهند شد.')) {
                localStorage.removeItem('hytraEquipmentData');
                localStorage.removeItem('visitReports');
                
                equipmentData = [...completeEquipmentData];
                visitReports = [];
                
                saveToLocalStorage();
                
                showMessage('تمامی داده‌ها با موفقیت پاک شدند. داده‌های پیش‌فرض بارگذاری شدند.', 'success');
                
                // به‌روزرسانی نمایش
                if (document.getElementById('equipment-management-tab').classList.contains('active')) {
                    displayEquipmentTable(equipmentData);
                    updateEquipmentStats();
                }
            }
        }
        
        // ==================== گزارش‌گیری جامع ====================
        function generateStatisticalReport() {
            showMessage('گزارش آماری در حال تولید...', 'success');
            
            // در نسخه کامل، این تابع گزارش آماری جامعی تولید می‌کند
            setTimeout(() => {
                document.getElementById('report-preview').innerHTML = `
                    <h4 style="color: var(--primary-color);">📈 گزارش آماری تجهیزات</h4>
                    <p><strong>تاریخ گزارش:</strong> ${new Date().toLocaleDateString('fa-IR')}</p>
                    <p><strong>تعداد کل تجهیزات:</strong> ${equipmentData.length} دستگاه</p>
                    <p><strong>تجهیزات ثابت:</strong> ${equipmentData.filter(item => item.type.includes("ثابت")).length} دستگاه</p>
                    <p><strong>تجهیزات سیار:</strong> ${equipmentData.filter(item => item.type.includes("سیار")).length} دستگاه</p>
                    <p><strong>تجهیزات دستی:</strong> ${equipmentData.filter(item => item.type.includes("دستی")).length} دستگاه</p>
                    <p><strong>گزارش‌های بازدید:</strong> ${visitReports.length} مورد</p>
                    <hr>
                    <p>این گزارش به صورت خودکار توسط سیستم مدیریت تجهیزات هایترا تولید شده است.</p>
                `;
                
                showMessage('گزارش آماری با موفقیت تولید شد.', 'success');
            }, 1000);
        }
        
        function showReportCharts() {
            showStatistics();
        }
        
        function generateEquipmentReport() {
            showMessage('گزارش تجهیزات در حال تولید...', 'success');
        }
        
        function generateMaintenanceReport() {
            showMessage('گزارش نگهداری در حال تولید...', 'success');
        }
        
        function generateFinancialReport() {
            showMessage('گزارش مالی در حال تولید...', 'success');
        }
        
        function generateSummaryReport() {
            showMessage('گزارش خلاصه در حال تولید...', 'success');
        }
        
        function exportReport(format) {
            switch(format) {
                case 'word':
                    generateWordReport();
                    break;
                case 'excel':
                    exportTableToExcel();
                    break;
                case 'whatsapp':
                    shareViaWhatsApp();
                    break;
                case 'telegram':
                    shareViaTelegram();
                    break;
                case 'bale':
                    shareViaBale();
                    break;
                case 'print':
                    printTable();
                    break;
            }
        }
        
        function shareViaWhatsApp() {
            const message = `📋 گزارش تجهیزات هایترا\n\n` +
                          `تعداد کل تجهیزات: ${equipmentData.length}\n` +
                          `ثابت: ${equipmentData.filter(item => item.type.includes("ثابت")).length}\n` +
                          `سیار: ${equipmentData.filter(item => item.type.includes("سیار")).length}\n` +
                          `دستی: ${equipmentData.filter(item => item.type.includes("دستی")).length}\n\n` +
                          `تاریخ گزارش: ${new Date().toLocaleDateString('fa-IR')}`;
            
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
            
            showMessage('واتساپ برای ارسال گزارش باز شد.', 'success');
        }
        
        function shareViaTelegram() {
            const message = `📋 گزارش تجهیزات هایترا\n\n` +
                          `تعداد کل: ${equipmentData.length} دستگاه\n` +
                          `تاریخ: ${new Date().toLocaleDateString('fa-IR')}`;
            
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodedMessage}`, '_blank');
            
            showMessage('تلگرام برای ارسال گزارش باز شد.', 'success');
        }
        
        function shareViaBale() {
            const message = `📋 گزارش تجهیزات هایترا\n\n` +
                          `تعداد کل تجهیزات: ${equipmentData.length}\n` +
                          `تاریخ گزارش: ${new Date().toLocaleDateString('fa-IR')}`;
            
            // کپی به کلیپ‌بورد
            const textarea = document.createElement('textarea');
            textarea.value = message;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            showMessage('متن گزارش در کلیپ‌بورد کپی شد. لطفاً در بله پیست کنید.', 'success');
            
            window.open('https://web.bale.ai/', '_blank');
        }
        
        function finalizeReport() {
            showMessage('گزارش با موفقیت تایید و ارسال شد.', 'success');
        }
        
        function clearReport() {
            document.getElementById('report-preview').innerHTML = 
                '<p style="color: #718096; text-align: center;">گزارشی انتخاب نشده است</p>';
        }
        
        function closeReportModal() {
            document.getElementById('report-modal').style.display = 'none';
        }
        
        function closeWordReport() {
            document.getElementById('word-report-container').style.display = 'none';
        }
        
        function closeConfirmModal() {
            document.getElementById('confirm-modal').style.display = 'none';
        }
        
        // ==================== ذخیره و بارگذاری ====================
        function saveToLocalStorage() {
            localStorage.setItem('hytraEquipmentData', JSON.stringify(equipmentData));
        }
        
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('hytraEquipmentData');
            if (savedData) {
                try {
                    equipmentData = JSON.parse(savedData);
                } catch (e) {
                    equipmentData = [...completeEquipmentData];
                }
            } else {
                equipmentData = [...completeEquipmentData];
            }
            
            // بارگذاری گزارش‌های بازدید
            const savedVisits = localStorage.getItem('visitReports');
            if (savedVisits) {
                try {
                    visitReports = JSON.parse(savedVisits);
                } catch (e) {
                    visitReports = [];
                }
            }
        }
        
        // ==================== راه‌اندازی اولیه ====================
        function initializeApp() {
            // بارگذاری داده‌ها
            loadFromLocalStorage();
            
            // تنظیم تاریخ‌های پیش‌فرض
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('visit-date').value = today;
            
            // تنظیم زمان‌های پیش‌فرض
            const now = new Date();
            const timeStr = now.toTimeString().split(':').slice(0, 2).join(':');
            document.getElementById('time-go').value = timeStr;
            
            const endTime = new Date(now.getTime() + 60 * 60 * 1000);
            const endTimeStr = endTime.toTimeString().split(':').slice(0, 2).join(':');
            document.getElementById('time-back').value = endTimeStr;
            
            // رویدادهای فرم تجهیزات
            document.getElementById('equipmentForm').addEventListener('submit', saveEquipment);
            document.getElementById('addEquipmentBtn').addEventListener('click', showEquipmentForm);
            document.getElementById('cancelFormBtn').addEventListener('click', hideEquipmentForm);
            document.getElementById('resetFormBtn').addEventListener('click', resetEquipmentForm);
            document.getElementById('searchBtn').addEventListener('click', searchEquipment);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);
            document.getElementById('showAllBtn').addEventListener('click', () => {
                clearSearch();
                showMessage('همه تجهیزات نمایش داده شدند.', 'success');
            });
            
            // رویدادهای تب‌ها
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // رویدادهای بارگذاری فایل
            document.getElementById('uploadArea').addEventListener('click', function() {
                document.getElementById('excelFileInput').click();
            });
            
            document.getElementById('excelFileInput').addEventListener('change', handleFileSelect);
            
            // رویدادهای درگ و دراپ
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.style.borderColor = '#4299e1';
                uploadArea.style.backgroundColor = '#ebf8ff';
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.style.borderColor = '#cbd5e0';
                uploadArea.style.backgroundColor = '#f7fafc';
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.style.borderColor = '#cbd5e0';
                uploadArea.style.backgroundColor = '#f7fafc';
                handleFileSelect(e);
            });
            
            // رویدادهای واردسازی
            document.getElementById('previewImportBtn').addEventListener('click', previewImportData);
            document.getElementById('importDataBtn').addEventListener('click', importData);
            document.getElementById('cancelImportBtn').addEventListener('click', resetImportForm);
            
            // رویدادهای بازدید
            document.getElementById('equipment-select').addEventListener('change', onEquipmentSelectChange);
            document.getElementById('actions-select').addEventListener('change', onActionSelectChange);
            document.getElementById('action-quantity').addEventListener('input', calculateActionTotal);
            
            // بارگذاری اولیه داده‌ها
            if (document.getElementById('equipment-management-tab').classList.contains('active')) {
                loadEquipmentData();
            }
            
            showMessage('سیستم مدیریت تجهیزات مخابراتی با موفقیت راه‌اندازی شد.', 'success');
        }
        
        // راه‌اندازی برنامه هنگام بارگذاری صفحه
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>           
